"use strict";var c=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}};var te=c(function(K){"use strict";Object.defineProperty(K,"__esModule",{value:true});K.INFO=K.WARN=K.ERROR=K.OFF=void 0;K.OFF="off";K.ERROR="error";K.WARN="warn";K.INFO="info"});var bt=c(function(Rt){"use strict";Object.defineProperty(Rt,"__esModule",{value:true});Rt.detectEndianness=yi;Rt.decodeBase64=mi;Rt.formatSize=Mi;Rt.describe=Ri;var je=80;function yi(){var e=new Uint16Array([4660]);var t=new Uint8Array(e.buffer);return t[0]===52?"LE":"BE"}function mi(e){return Duktape.dec("base64",e)}function Mi(e){if(typeof e!=="number"){return void 0}if(Math.abs(e)<1024){return e+" B"}if(Math.abs(e)<1024*1024){return Ve(e/1024)+" KB"}return Ve(e/(1024*1024))+" MB"}function Ve(e){
return~~(1e3*e)/1e3}function Ri(e){var t=typeof e;if(t==="string"){if(e.length>je){return'"'.concat(e.substr(0,je),'..."')}return'"'.concat(e,'"')}if(t==="function"){var r=ee(e.constructor);var o=ee(e);return o?"".concat(r,"(").concat(o,")"):r}if(e&&t==="object"){var r=ee(e.constructor);if(r==="Object"){return r}var s=e.length;return s!=null?"".concat(r,"(").concat(s,")"):r}return String(e)}var Pi=/function ([^(]+)/;function ee(e){if(e.name){return e.name}var t=e.toString().match(Pi);if(t&&t[1]){
return t[1]}return""}});var Ue=c(function(C){"use strict";var tt;Object.defineProperty(C,"__esModule",{value:true});C.FOUR_SCREEN=C.VERTICAL=C.HORIZONTAL=C.SCREEN_3=C.SCREEN_2=C.SCREEN_1=C.SCREEN_0=void 0;C.getAreas=Ci;C.getSingle=xi;var vi=bt();C.SCREEN_0="S0";C.SCREEN_1="S1";C.SCREEN_2="S2";C.SCREEN_3="S3";C.HORIZONTAL="H";C.VERTICAL="V";C.FOUR_SCREEN="4S";var _i=(tt={},tt[C.SCREEN_0]=[0,0,0,0],tt[C.SCREEN_1]=[1,1,1,1],tt[C.SCREEN_2]=[2,2,2,2],tt[C.SCREEN_3]=[3,3,3,3],tt[C.HORIZONTAL]=[0,0,1,1],tt[C.VERTICAL]=[0,1,0,
1],tt[C.FOUR_SCREEN]=[0,1,2,3],tt);function Ci(e){var t=_i[e];if(t){return t}throw new Error("Invalid mirroring: "+(0,vi.describe)(e))}function xi(e){return"S"+e}});var Ge=c(function(et){"use strict";Object.defineProperty(et,"__esModule",{value:true});et.PAL=et.NTSC=void 0;et.getParams=bi;var Oi=bt();et.NTSC="NTSC";et.PAL="PAL";var Fi={framesPerSecond:60,cpuFrequency:1789773,ppuClipTopBottom:true,frameCounterMax4:[7457,7456,7458,7457,1,1],frameCounterMax5:[7457,7456,7458,7458,7452,1],noiseChannelTimerPeriods:[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],dmcChannelTimerPeriods:[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54]};var Si={
framesPerSecond:50,cpuFrequency:1789773*5/6,ppuClipTopBottom:false,frameCounterMax4:[8313,8314,8312,8313,1,1],frameCounterMax5:[8313,8314,8312,8314,8312,1],noiseChannelTimerPeriods:[4,8,14,30,60,88,118,148,188,236,354,472,708,944,1890,3778],dmcChannelTimerPeriods:[398,354,316,298,276,236,210,198,176,148,132,118,98,78,66,50]};function bi(e){switch(e){case et.NTSC:return Fi;case et.PAL:return Si;default:throw new Error("Invalid region: "+(0,Oi.describe)(e))}}});var Ye=c(function(I){"use strict";Object.defineProperty(I,"__esModule",{value:true});I.UNROM=I.NROM=I.NINA_001=I.MMC3=I.MMC1=I.COLOR_DREAMS=I.CNROM=I.BNROM=I.AOROM=void 0;I.AOROM="AOROM";I.BNROM="BNROM";I.CNROM="CNROM";I.COLOR_DREAMS="COLOR_DREAMS";I.MMC1="MMC1";I.MMC3="MMC3";I.NINA_001="NINA_001";I.NROM="NROM";I.UNROM="UNROM"});var Qe=c(function(ot){"use strict";Object.defineProperty(ot,"__esModule",{value:true});ot.SXROM=ot.SOROM=ot.SUROM=void 0;ot.SUROM="SUROM";ot.SOROM="SOROM";ot.SXROM="SXROM"});var tr=c(function(Bt){"use strict";var Pt;Object.defineProperty(Bt,"__esModule",{value:true});Bt.Log=void 0;var Bi=bt();var nt=te();var Ke=0;var We=1;var Ze=2;var Je=3;var wi=(Pt={},Pt[nt.OFF]=Ke,Pt[nt.ERROR]=We,Pt[nt.WARN]=Ze,Pt[nt.INFO]=Je,Pt);var $e=function(){function e(t){this.output=t;this.priority=Ke;this.level=nt.OFF}e.prototype.setLevel=function(t){var r=wi[t];if(r==null){throw new Error("Invalid log level: "+(0,Bi.describe)(t))}this.priority=r;this.level=t};e.prototype.getLevel=function(){
return this.level};e.prototype.error=function(t,r){if(r===void 0){r=void 0}if(this.priority>=We){this.output[nt.ERROR](t,r)}};e.prototype.warn=function(t){if(this.priority>=Ze){this.output[nt.WARN](t)}};e.prototype.info=function(t){if(this.priority>=Je){this.output[nt.INFO](t)}};return e}();Bt.Log=$e;Bt.default=new $e(console)});var B=c(function(_){"use strict";var Ei=_&&_.__createBinding||(Object.create?function(e,t,r,o){if(o===void 0)o=r;var s=Object.getOwnPropertyDescriptor(t,r);if(!s||("get"in s?!t.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,o,s)}:function(e,t,r,o){if(o===void 0)o=r;e[o]=t[r]});var Di=_&&_.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var wt=_&&
_.__importStar||function(){var e=function(t){e=Object.getOwnPropertyNames||function(r){var o=[];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s))o[o.length]=s;return o};return e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(t!=null){for(var o=e(t),s=0;s<o.length;s++)if(o[s]!=="default")Ei(r,t,o[s])}Di(r,t);return r}}();var Ii=_&&_.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(_,"__esModule",{value:true});_.describe=_.formatSize=
_.decodeBase64=_.detectEndianness=_.Submapper=_.Mapper=_.Region=_.Mirroring=_.LogLevel=_.log=void 0;var ki=wt(te());_.LogLevel=ki;var Li=wt(Ue());_.Mirroring=Li;var Ti=wt(Ge());_.Region=Ti;var Ni=wt(Ye());_.Mapper=Ni;var Hi=wt(Qe());_.Submapper=Hi;var zi=tr();Object.defineProperty(_,"log",{enumerable:true,get:function(){return Ii(zi).default}});var qt=bt();Object.defineProperty(_,"detectEndianness",{enumerable:true,get:function(){return qt.detectEndianness}});Object.defineProperty(_,"decodeBase6\
4",{enumerable:true,get:function(){return qt.decodeBase64}});Object.defineProperty(_,"formatSize",{enumerable:true,get:function(){return qt.formatSize}});Object.defineProperty(_,"describe",{enumerable:true,get:function(){return qt.describe}})});var er=c(function(re){"use strict";Object.defineProperty(re,"__esModule",{value:true});var Xt=B();var qi=function(){function e(){Xt.log.info("Initializing CPU memory");this.ram=new Uint8Array(2048);this.prgROM=null;this.prgRAM=null;this.prgROMMapping=new Uint32Array(4);this.prgRAMMapping=0;this.inputDevices=[null,null,null];this.inputStrobe=0;this.ppu=null;this.apu=null;this.dma=null;this.mapper=null}e.prototype.connect=function(t){Xt.log.info("Connecting CPU memory");this.ppu=t.ppu;this.apu=t.apu;
this.dma=t.dma};e.prototype.setMapper=function(t){this.mapper=t;this.prgRAM=t&&t.prgRAM;this.prgROM=t&&t.prgROM};e.prototype.reset=function(){Xt.log.info("Resetting CPU memory");this.resetRAM();this.resetRegisters();this.resetPRGRAM();this.resetPRGROM()};e.prototype.read=function(t){if(t>=32768){return this.readPRGROM(t)}else if(t<8192){return this.readRAM(t)}else if(t<16416){return this.readRegister(t)}else if(t>=24576){return this.readPRGRAM(t)}return this.readEXROM(t)};e.prototype.write=function(t,r){
if(t>=32768){this.writePRGROM(t,r)}else if(t<8192){this.writeRAM(t,r)}else if(t<16416){this.writeRegister(t,r)}else if(t>=24576){this.writePRGRAM(t,r)}else{this.writeEXROM(t,r)}};e.prototype.resetRAM=function(){this.ram.fill(0)};e.prototype.readRAM=function(t){return this.ram[this.mapRAMAddress(t)]};e.prototype.writeRAM=function(t,r){this.ram[this.mapRAMAddress(t)]=r};e.prototype.mapRAMAddress=function(t){return t&2047};e.prototype.resetRegisters=function(){this.inputStrobe=0};e.prototype.readRegister=
function(t){switch(this.mapRegisterAddress(t)){case 8194:return this.ppu.readStatus();case 8196:return this.ppu.readOAMData();case 8199:return this.ppu.readData();case 16405:return this.apu.readStatus();case 16406:return this.readInputDevice(1);case 16407:return this.readInputDevice(2);default:return 0}};e.prototype.writeRegister=function(t,r){switch(this.mapRegisterAddress(t)){case 8192:this.ppu.writeControl(r);break;case 8193:this.ppu.writeMask(r);break;case 8195:this.ppu.writeOAMAddress(r);break;case 8196:
this.ppu.writeOAMData(r);break;case 8197:this.ppu.writeScroll(r);break;case 8198:this.ppu.writeAddress(r);break;case 8199:this.ppu.writeData(r);break;case 16404:this.dma.writeAddress(r);break;case 16406:this.writeInputDevice(r);break;case 16384:this.apu.writePulseDutyEnvelope(1,r);break;case 16385:this.apu.writePulseSweep(1,r);break;case 16386:this.apu.writePulseTimer(1,r);break;case 16387:this.apu.writePulseLengthCounter(1,r);break;case 16388:this.apu.writePulseDutyEnvelope(2,r);break;case 16389:
this.apu.writePulseSweep(2,r);break;case 16390:this.apu.writePulseTimer(2,r);break;case 16391:this.apu.writePulseLengthCounter(2,r);break;case 16392:this.apu.writeTriangleLinearCounter(r);break;case 16394:this.apu.writeTriangleTimer(r);break;case 16395:this.apu.writeTriangleLengthCounter(r);break;case 16396:this.apu.writeNoiseEnvelope(r);break;case 16398:this.apu.writeNoiseTimer(r);break;case 16399:this.apu.writeNoiseLengthCounter(r);break;case 16400:this.apu.writeDMCFlagsTimer(r);break;case 16401:
this.apu.writeDMCOutputLevel(r);break;case 16402:this.apu.writeDMCSampleAddress(r);break;case 16403:this.apu.writeDMCSampleLength(r);break;case 16405:this.apu.writeStatus(r);break;case 16407:this.apu.writeFrameCounter(r);this.writeInputDevice(r);break}};e.prototype.mapRegisterAddress=function(t){if(t<16384){return t&8199}return t};e.prototype.setInputDevice=function(t,r){Xt.log.info("".concat(r!=null?"Setting":"Clearing"," device connected to CPU memory on port #").concat(t));this.inputDevices[t]=
r};e.prototype.getInputDevice=function(t){return this.inputDevices[t]};e.prototype.readInputDevice=function(t){var r=this.inputDevices[t];return r?r.read():0};e.prototype.writeInputDevice=function(t){var r=t&1;if(r&&!this.inputStrobe){this.strobeInputDevice(1);this.strobeInputDevice(2)}this.inputStrobe=r};e.prototype.strobeInputDevice=function(t){var r=this.inputDevices[t];if(r){r.strobe()}};e.prototype.readEXROM=function(t){return 0};e.prototype.writeEXROM=function(t,r){};e.prototype.resetPRGRAM=
function(){this.prgRAMMapping=0};e.prototype.readPRGRAM=function(t){if(this.prgRAM&&this.mapper.canReadPRGRAM){return this.prgRAM[this.mapPRGRAMAddress(t)]}return 0};e.prototype.writePRGRAM=function(t,r){if(this.prgRAM&&this.mapper.canWritePRGRAM){this.prgRAM[this.mapPRGRAMAddress(t)]=r;if(this.mapper.hasPRGRAMRegisters){this.mapper.write(t,r)}}};e.prototype.mapPRGRAMAddress=function(t){return this.prgRAMMapping|t&8191};e.prototype.mapPRGRAMBank=function(t,r){this.prgRAMMapping=r*8192};e.prototype.
resetPRGROM=function(){this.prgROMMapping.fill(0)};e.prototype.readPRGROM=function(t){return this.prgROM[this.mapPRGROMAddress(t)]};e.prototype.writePRGROM=function(t,r){this.mapper.write(t,r)};e.prototype.mapPRGROMAddress=function(t){return this.prgROMMapping[(t&24576)>>>13]|t&8191};e.prototype.mapPRGROMBank=function(t,r){this.prgROMMapping[t]=r*8192};return e}();re.default=qi});var rr=c(function(ie){"use strict";Object.defineProperty(ie,"__esModule",{value:true});var jt=B();var Xi=[9,1,0,1,0,2,2,13,8,16,8,36,0,0,4,44,9,1,52,3,0,4,0,20,8,58,0,2,0,32,44,8];var ji=function(){function e(){jt.log.info("Initializing PPU memory");this.patterns=null;this.patternsMapping=new Uint32Array(8);this.canWritePattern=false;this.nametables=new Uint8Array(4096);this.nametablesMapping=new Uint32Array(4);this.palettes=new Uint8Array(32);this.mapper=null}e.prototype.setMapper=function(t){this.
mapper=t;this.patterns=t&&(t.chrRAM||t.chrROM);this.canWritePattern=t!=null&&t.chrRAM!=null};e.prototype.reset=function(){jt.log.info("Resetting PPU memory");this.resetPatterns();this.resetNametables();this.resetPalettes()};e.prototype.read=function(t){t=this.mapAddress(t);if(t<8192){return this.readPattern(t)}else if(t<16128){return this.readNametable(t)}return this.readPalette(t)};e.prototype.write=function(t,r){t=this.mapAddress(t);if(t<8192){this.writePattern(t,r)}else if(t<16128){this.writeNametable(
t,r)}else{this.writePalette(t,r)}};e.prototype.mapAddress=function(t){return t&16383};e.prototype.resetPatterns=function(){this.patternsMapping.fill(0)};e.prototype.readPattern=function(t){return this.patterns[this.mapPatternAddress(t)]};e.prototype.writePattern=function(t,r){if(this.canWritePattern){this.patterns[this.mapPatternAddress(t)]=r}};e.prototype.mapPatternAddress=function(t){return this.patternsMapping[(t&7168)>>>10]|t&1023};e.prototype.mapPatternsBank=function(t,r){this.patternsMapping[t]=
r*1024};e.prototype.resetNametables=function(){this.nametables.fill(0);this.setNametablesMirroring(this.mapper&&this.mapper.mirroring||jt.Mirroring.SCREEN_0)};e.prototype.readNametable=function(t){return this.nametables[this.mapNametableAddress(t)]};e.prototype.writeNametable=function(t,r){this.nametables[this.mapNametableAddress(t)]=r};e.prototype.mapNametableAddress=function(t){return this.nametablesMapping[(t&3072)>>>10]|t&1023};e.prototype.setNametablesMirroring=function(t){var r=jt.Mirroring.
getAreas(t);for(var o=0;o<4;o++){this.nametablesMapping[o]=r[o]*1024}};e.prototype.resetPalettes=function(){this.palettes.set(Xi)};e.prototype.readPalette=function(t){return this.palettes[this.mapPaletteAddress(t)]};e.prototype.writePalette=function(t,r){this.palettes[this.mapPaletteAddress(t)]=r};e.prototype.mapPaletteAddress=function(t){if(t&3){return t&31}return t&15};return e}();ie.default=ji});var or=c(function(ne){"use strict";Object.defineProperty(ne,"__esModule",{value:true});var oe=B();var ir=512;var Vi=function(){function e(){oe.log.info("Initializing DMA");this.cycle=0;this.baseAddress=0;this.cpuMemory=null}e.prototype.connect=function(t){oe.log.info("Connecting DMA");this.cpuMemory=t.cpuMemory};e.prototype.reset=function(){oe.log.info("Resetting DMA");this.cycle=ir};e.prototype.writeAddress=function(t){this.cycle=0;this.baseAddress=t<<8};e.prototype.tick=function(){if(this.isBlockingCPU()){
this.cycle++;if(this.cycle&1){this.transferData()}}};e.prototype.isBlockingCPU=function(){return this.cycle<ir};e.prototype.transferData=function(){var t=this.baseAddress+(this.cycle>>1);var r=this.cpuMemory.read(t);this.cpuMemory.write(8196,r)};return e}();ne.default=Vi});var W=c(function(se){"use strict";Object.defineProperty(se,"__esModule",{value:true});var st=B();var Ui=function(){function e(t){st.log.info("Initializing mapper");this.mirroring=t.mirroring;this.prgROM=t.prgROM;this.chrROM=t.chrROM;this.prgROMSize=t.prgROMSize;this.chrROMSize=t.chrROMSize;var r=t.prgRAMSize,o=t.prgRAMSizeBattery;this.prgRAM=r?new Uint8Array(r):null;this.prgRAMSize=r;this.prgRAMSizeBattery=o;this.canReadPRGRAM=r>0;this.canWritePRGRAM=r>0;this.hasPRGRAMRegisters=false;var s=t.chrRAMSize,
a=t.chrRAMSizeBattery;this.chrRAM=s?new Uint8Array(s):null;this.chrRAMSize=s;this.chrRAMSizeBattery=a;if(o){this.nvram=this.prgRAM.subarray(0,o)}else if(a){this.nvram=this.chrRAM.subarray(0,a)}else{this.nvram=null}this.cpu=null;this.ppu=null;this.cpuMemory=null;this.ppuMemory=null}e.prototype.connect=function(t){st.log.info("Connecting mapper");this.cpu=t.cpu;this.ppu=t.ppu;this.cpuMemory=t.cpuMemory;this.ppuMemory=t.ppuMemory;this.cpu.setMapper(this);this.cpuMemory.setMapper(this);this.ppuMemory.
setMapper(this)};e.prototype.disconnect=function(){st.log.info("Disconnecting mapper");this.ppuMemory.setMapper(null);this.cpuMemory.setMapper(null);this.cpu.setMapper(null);this.ppuMemory=null;this.cpuMemory=null;this.ppu=null;this.cpu=null};e.prototype.reset=function(){st.log.info("Resetting mapper");this.resetPRGRAM();this.resetCHRRAM();this.resetState()};e.prototype.resetState=function(){};e.prototype.write=function(t,r){};e.prototype.tick=function(){};e.prototype.mapPRGROMBank32K=function(t,r){
this.mapPRGROMBank8K(t*4,r*4,4)};e.prototype.mapPRGROMBank16K=function(t,r){this.mapPRGROMBank8K(t*2,r*2,2)};e.prototype.mapPRGROMBank8K=function(t,r,o){if(o===void 0){o=1}var s=this.prgROMSize-1>>13;for(var a=0;a<o;a++){this.cpuMemory.mapPRGROMBank(t+a,r+a&s)}};e.prototype.resetPRGRAM=function(){if(this.prgRAM){this.prgRAM.fill(0,this.prgRAMSizeBattery)}};e.prototype.mapPRGRAMBank8K=function(t,r){var o=this.prgRAMSize-1>>13;this.cpuMemory.mapPRGRAMBank(t,r&o)};e.prototype.resetCHRRAM=function(){
if(this.chrRAM){this.chrRAM.fill(0,this.chrRAMSizeBattery)}};e.prototype.mapCHRBank8K=function(t,r){this.mapCHRBank1K(t*8,r*8,8)};e.prototype.mapCHRBank4K=function(t,r){this.mapCHRBank1K(t*4,r*4,4)};e.prototype.mapCHRBank2K=function(t,r){this.mapCHRBank1K(t*2,r*2,2)};e.prototype.mapCHRBank1K=function(t,r,o){if(o===void 0){o=1}var s=this.chrROMSize||this.chrRAMSize;var a=s-1>>10;for(var P=0;P<o;P++){this.ppuMemory.mapPatternsBank(t+P,r+P&a)}};e.prototype.getNVRAM=function(){return this.nvram};e.prototype.
setSingleScreenMirroring=function(t){if(t===void 0){t=0}this.ppuMemory.setNametablesMirroring(st.Mirroring.getSingle(t))};e.prototype.setVerticalMirroring=function(){this.ppuMemory.setNametablesMirroring(st.Mirroring.VERTICAL)};e.prototype.setHorizontalMirroring=function(){this.ppuMemory.setNametablesMirroring(st.Mirroring.HORIZONTAL)};e.prototype.setFourScreenMirroring=function(){this.ppuMemory.setNametablesMirroring(st.Mirroring.FOUR_SCREEN)};return e}();se.default=Ui});var nr=c(function(pt){"use strict";var Gi=pt&&pt.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var Yi=pt&&pt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(pt,"__esModule",{value:true});var Qi=Yi(W());var Ki=function(e){Gi(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank32K(0,0);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){this.mapPRGROMBank32K(0,o);this.setSingleScreenMirroring((o&16)>>>4)};return t}(Qi.default);pt.default=Ki});var sr=c(function(ht){"use strict";var Wi=ht&&ht.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var Zi=ht&&ht.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(ht,"__esModule",{value:true});var Ji=Zi(W());var $i=function(e){Wi(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank32K(0,0);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){this.mapPRGROMBank32K(0,o)};return t}(Ji.default);ht.default=$i});var ar=c(function(ct){"use strict";var to=ct&&ct.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var eo=ct&&ct.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(ct,"__esModule",{value:true});var ro=eo(W());var io=function(e){to(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank16K(0,0);this.mapPRGROMBank16K(1,-1);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){this.mapCHRBank8K(0,o)};return t}(ro.default);ct.default=io});var ur=c(function(lt){"use strict";var oo=lt&&lt.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var no=lt&&lt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(lt,"__esModule",{value:true});var so=no(W());var ao=function(e){oo(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank32K(0,0);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){this.mapPRGROMBank32K(0,o);this.mapCHRBank8K(0,o>>>4)};return t}(so.default);lt.default=ao});var pr=c(function(ft){"use strict";var uo=ft&&ft.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var po=ft&&ft.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(ft,"__esModule",{value:true});var ho=po(W());var co=function(e){uo(t,e);function t(r){var o=e.call(this,r)||this;o.shiftRegister=0;o.writesCount=0;o.controlRegister=0;o.prgBankRegister=0;o.chrBankRegister1=0;o.chrBankRegister2=0;o.snrom=(o.prgROMSize===131072||o.prgROMSize===262144)&&o.prgRAMSize===8192&&(o.chrROMSize===8192||o.chrRAMSize===8192);return o}t.prototype.
resetState=function(){this.resetShiftRegister();this.resetBankRegisters();this.synchronizeMapping()};t.prototype.resetShiftRegister=function(){this.shiftRegister=0;this.writesCount=0};t.prototype.resetBankRegisters=function(){this.controlRegister=12;this.prgBankRegister=0;this.chrBankRegister1=0;this.chrBankRegister2=0};t.prototype.write=function(r,o){if(o&128){this.resetShiftRegister();this.controlRegister|=12}else{this.shiftRegister|=(o&1)<<this.writesCount;if(++this.writesCount>=5){this.copyShiftRegister(
r);this.resetShiftRegister();this.synchronizeMapping()}}};t.prototype.copyShiftRegister=function(r){switch(r&57344){case 32768:this.controlRegister=this.shiftRegister;break;case 40960:this.chrBankRegister1=this.shiftRegister;break;case 49152:this.chrBankRegister2=this.shiftRegister;break;case 57344:this.prgBankRegister=this.shiftRegister;break}};t.prototype.synchronizeMapping=function(){this.switchMirroring();this.switchPRGROMBanks();this.switchPRGRAMBank();this.switchCHRBanks()};t.prototype.switchMirroring=
function(){switch(this.controlRegister&3){case 0:this.setSingleScreenMirroring(0);break;case 1:this.setSingleScreenMirroring(1);break;case 2:this.setVerticalMirroring();break;case 3:this.setHorizontalMirroring();break}};t.prototype.switchPRGROMBanks=function(){var r=this.chrRAM?this.chrBankRegister1&16:0;var o=this.prgBankRegister&15;switch(this.controlRegister&12){case 12:this.mapPRGROMBank16K(0,r|o);this.mapPRGROMBank16K(1,r|15);break;case 8:this.mapPRGROMBank16K(0,r);this.mapPRGROMBank16K(1,r|
o);break;default:this.mapPRGROMBank32K(0,(r|o)>>>1);break}};t.prototype.switchPRGRAMBank=function(){var r=(this.prgBankRegister&16)===0;var o=(this.chrBankRegister1&16)===0;var s=r&&(!this.snrom||o);this.mapPRGRAMBank8K(0,this.chrRAM?this.chrBankRegister1>>>2:0);this.canReadPRGRAM=s;this.canWritePRGRAM=s};t.prototype.switchCHRBanks=function(){if(this.controlRegister&16){this.mapCHRBank4K(0,this.chrBankRegister1);this.mapCHRBank4K(1,this.chrBankRegister2)}else{this.mapCHRBank8K(0,this.chrBankRegister1>>>
1)}};return t}(ho.default);ft.default=co});var dt=c(function(L){"use strict";Object.defineProperty(L,"__esModule",{value:true});L.IRQ=L.IRQ_EXT=L.IRQ_DMC=L.IRQ_APU=L.NMI=L.RESET=void 0;L.RESET=1;L.NMI=2;L.IRQ_APU=4;L.IRQ_DMC=8;L.IRQ_EXT=16;L.IRQ=L.IRQ_APU|L.IRQ_DMC|L.IRQ_EXT});var cr=c(function(At){"use strict";var lo=At&&At.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var fo=At&&At.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(At,"__esModule",{value:true});var Ao=B();var hr=dt();var go=fo(W());var yo=function(e){lo(t,e);function t(r){var o=e.call(this,r)||this;o.bankSelect=0;o.irqCounter=0;o.irqLatch=0;o.irqReload=0;o.irqEnabled=0;o.irqDelay=0;o.alternateMode=false;return o}t.prototype.resetState=function(){this.resetMapping();this.resetRegisters()};t.prototype.resetMapping=function(){
this.mapPRGROMBank16K(0,0);this.mapPRGROMBank16K(1,-1);this.mapPRGRAMBank8K(0,0);this.mapCHRBank8K(0,0)};t.prototype.resetRegisters=function(){this.bankSelect=0;this.irqCounter=0;this.irqLatch=0;this.irqReload=0;this.irqEnabled=0;this.irqDelay=0};t.prototype.write=function(r,o){switch(r&57345){case 32768:this.bankSelect=o;break;case 32769:this.writeBankData(o);break;case 40960:this.writeMirroring(o);break;case 40961:this.writePRGRAMEnable(o);break;case 49152:this.irqLatch=o;break;case 49153:this.
writeIRQReload();break;case 57344:this.writeIRQEnable(false);break;case 57345:this.writeIRQEnable(true);break}};t.prototype.writeBankData=function(r){switch(this.bankSelect&7){case 0:case 1:this.switchDoubleCHRROMBanks(r);break;case 2:case 3:case 4:case 5:this.switchSingleCHRROMBanks(r);break;case 6:this.switchPRGROMBanks0And2(r);break;case 7:this.switchPRGROMBank1(r);break}};t.prototype.writeMirroring=function(r){if(this.mirroring!==Ao.Mirroring.FOUR_SCREEN){this.switchMirroring(r)}};t.prototype.
writePRGRAMEnable=function(r){this.canReadPRGRAM=(r&128)===128;this.canWritePRGRAM=(r&192)===128};t.prototype.writeIRQReload=function(){if(this.alternateMode){this.irqReload=1}this.irqCounter=0};t.prototype.writeIRQEnable=function(r){this.irqEnabled=r;if(!r){this.cpu.clearInterrupt(hr.IRQ_EXT)}};t.prototype.switchDoubleCHRROMBanks=function(r){var o=(this.bankSelect&128)>>>6|this.bankSelect&1;this.mapCHRBank2K(o,r>>>1)};t.prototype.switchSingleCHRROMBanks=function(r){var o=(~this.bankSelect&128)>>>
5|this.bankSelect-2&3;this.mapCHRBank1K(o,r)};t.prototype.switchPRGROMBanks0And2=function(r){var o=(this.bankSelect&64)>>>5;var s=(~this.bankSelect&64)>>>5;this.mapPRGROMBank8K(o,r);this.mapPRGROMBank8K(s,-2)};t.prototype.switchPRGROMBank1=function(r){this.mapPRGROMBank8K(1,r)};t.prototype.switchMirroring=function(r){if(r&1){this.setHorizontalMirroring()}else{this.setVerticalMirroring()}};t.prototype.tick=function(){if(this.ppu.addressBus&4096){if(!this.irqDelay){this.updateIRQCounter()}this.irqDelay=
7}else if(this.irqDelay){this.irqDelay--}};t.prototype.updateIRQCounter=function(){var r=this.irqCounter;if(!this.irqCounter||this.irqReload){this.irqCounter=this.irqLatch}else{this.irqCounter--}if(this.irqEnabled&&!this.irqCounter&&(!this.alternateMode||r||this.irqReload)){this.cpu.activateInterrupt(hr.IRQ_EXT)}this.irqReload=0};return t}(go.default);At.default=yo});var lr=c(function(gt){"use strict";var mo=gt&&gt.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var Mo=gt&&gt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(gt,"__esModule",{value:true});var Ro=Mo(W());var Po=function(e){mo(t,e);function t(r){var o=e.call(this,r)||this;o.hasPRGRAMRegisters=true;return o}t.prototype.resetState=function(){this.mapPRGROMBank32K(0,0);this.mapPRGRAMBank8K(0,0);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){switch(r){case 32765:this.mapPRGROMBank32K(0,o);break;case 32766:this.mapCHRBank4K(
0,o);break;case 32767:this.mapCHRBank4K(1,o);break}};return t}(Ro.default);gt.default=Po});var fr=c(function(yt){"use strict";var vo=yt&&yt.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var _o=yt&&yt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(yt,"__esModule",{value:true});var Co=_o(W());var xo=function(e){vo(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank16K(0,0);this.mapPRGROMBank16K(1,-1);this.mapCHRBank8K(0,0)};return t}(Co.default);yt.default=xo});var dr=c(function(mt){"use strict";var Oo=mt&&mt.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a))o[a]=s[a]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function o(){this.constructor=t}t.prototype=r===null?Object.create(r):(o.
prototype=r.prototype,new o)}}();var Fo=mt&&mt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(mt,"__esModule",{value:true});var So=Fo(W());var bo=function(e){Oo(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.resetState=function(){this.mapPRGROMBank16K(0,0);this.mapPRGROMBank16K(1,-1);this.mapCHRBank8K(0,0)};t.prototype.write=function(r,o){this.mapPRGROMBank16K(0,o)};return t}(So.default);mt.default=bo});var Ar=c(function(Et){"use strict";var rt=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};var U;Object.defineProperty(Et,"__esModule",{value:true});Et.createMapper=zo;var G=B();var Bo=rt(nr());var wo=rt(sr());var Eo=rt(ar());var Do=rt(ur());var Io=rt(pr());var ko=rt(cr());var Lo=rt(lr());var To=rt(fr());var No=rt(dr());var Ho=(U={},U[G.Mapper.AOROM]=Bo.default,U[G.Mapper.BNROM]=wo.default,U[G.Mapper.CNROM]=Eo.default,U[G.Mapper.COLOR_DREAMS]=Do.default,U[G.Mapper.MMC1]=
Io.default,U[G.Mapper.MMC3]=ko.default,U[G.Mapper.NINA_001]=Lo.default,U[G.Mapper.NROM]=To.default,U[G.Mapper.UNROM]=No.default,U);function zo(e){var t=e.mapper;var r=Ho[t];if(r){G.log.info('Creating "'.concat(t,'" mapper'));return new r(e)}throw new Error("Invalid mapper: "+(0,G.describe)(t))}});var gr=c(function(j){"use strict";var ae=j&&j.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(j,"__esModule",{value:true});j.createMapper=j.DMA=j.PPUMemory=j.CPUMemory=void 0;var qo=er();Object.defineProperty(j,"CPUMemory",{enumerable:true,get:function(){return ae(qo).default}});var Xo=rr();Object.defineProperty(j,"PPUMemory",{enumerable:true,get:function(){return ae(Xo).default}});var jo=or();Object.defineProperty(j,"DMA",{enumerable:true,get:function(){
return ae(jo).default}});var Vo=Ar();Object.defineProperty(j,"createMapper",{enumerable:true,get:function(){return Vo.createMapper}})});var ue=c(function(vt){"use strict";Object.defineProperty(vt,"__esModule",{value:true});vt.VIDEO_HEIGHT=vt.VIDEO_WIDTH=void 0;vt.VIDEO_WIDTH=256;vt.VIDEO_HEIGHT=240});var Vt=c(function(_t){"use strict";Object.defineProperty(_t,"__esModule",{value:true});_t.BLACK_COLOR=void 0;_t.packColor=yr;_t.unpackColor=Go;var Uo=B();var Ws=(0,Uo.detectEndianness)()==="LE";_t.BLACK_COLOR=yr(0,0,0);function yr(e,t,r,o){if(o===void 0){o=255}return(e&248)<<8|(t&252)<<3|r>>3}function Go(e){return[(e>>11&31)<<3,(e>>5&63)<<2,(e&31)<<3]}});var mr=c(function(pe){"use strict";Object.defineProperty(pe,"__esModule",{value:true});pe.default="YGBgACF7AACcMQCLWQBvbwAxZAAATxEALxkAJykAAEQAADk3ADlPAAAADAwMDAwMrq6uEFbOGyz/YCDsqQC/yhZUyhoInjoEZ1EAQ2EAAHwAAHFTAHGHDAwMDAwMDAwM////RJ7+XGz/mWb/12D//2KV/2RT9JQwwqwAkMQUUtIoIMaSGLrSTExMDAwMDAwM////o8z/pLT/wbb/4Lf//8DF/7yr/9Cf/OCQ4uqYyvKgoOrioOL6tra2DAwMDAwM"});var Mr=c(function(he){"use strict";Object.defineProperty(he,"__esModule",{value:true});he.default="bGxsACCUAACoPACYcABwfAA8cAAAaBAARhoAPCwAAFAAADxMADpmAAAAEBAQEBAQurq6KljWPDL/gCDwwADA0BR00hokpjweflIAWGQAAIgAAHRoAHKeEBAQEBAQEBAQ////XqD/jIL/xHD//1z//2i8/3J8/JZK2a0AmMYuTtROOsiaLr7cWFhYEBAQEBAQ////xtj/1Mr/8MT//7z//8Tw/8rU/9i+/+am6uyyxvTGuuzqtub/wsLCEBAQEBAQ"});var Rr=c(function(ce){"use strict";Object.defineProperty(ce,"__esModule",{value:true});ce.default="UlJSAACACACKLAB+SgBOUAAGRAAAJggACiAAAC4AADIAACYKABxIAAAAAAAAAAAApKSkADjONBbsXgTcjACwmgBMkBgAcDYATFQADmwAAHQAAGwsAF6EAAAAAAAAAAAA////TJz/fHj/pmT/2lr/8FTA8GpW1oYQuqQAdsAARswaLshmNMK+Ojo6AAAAAAAA////ttr/yMr/2sL/8L7//Lzu+sLA8syi5tqSzOaOuO6iruq+rujisLCwAAAAAAAA"});var Pr=c(function(le){"use strict";Object.defineProperty(le,"__esModule",{value:true});le.default="aGhoABKZGgiqUQKafgBpjgAcfgMBURgAHzcAAU4AAFoAAFAcAEBhAAAAAAAAAAAAubm5DFzXUDXwiRnguwyzzgxhwCsOlU0BYW8AH4sAAZgMAJNLAIGbAAAAAAAAAAAA////Y7T/m5H/03f/72r/+WjA+X1s7Zstvb0WfNocS+hHNeWRP9ndYGBgAAAAAAAA////rOf/1c3/7br/+LD//rDs/b21+dKO6Ot8u/OCmfeiivXQkvTxvr6+AAAAAAAA"});var vr=c(function(fe){"use strict";Object.defineProperty(fe,"__esModule",{value:true});fe.default="YGBgAAB4FACALABuSgBObAAYWgMCURgANCQAADQAADIAADQgACx4AAAAAgICAgICxMTEAFjeMB/8fxTgqACwwAZcwCsOpkAQb2EAMIAAAHwAAHw8AG6EFBQUBAQEBAQE8PDwTKr/b3P1sHD/2lr/8GDA+INt0JAw1MAwZtAAJt0aLshmNMK+VFRUBgYGBgYG////ttr/yMr/2sL/8L7//Lzu/9C0/9qQ7OyS3PaeuP+iruq+nu/vvr6+CAgICAgI"});var _r=c(function(de){"use strict";Object.defineProperty(de,"__esModule",{value:true});de.default="YGBgAABwFACALABuSgBObAAYWgMCURgANCQAADQAADIAADQgACx4AAAAAgICAgICxMTEAFjeMB/8fxTgqACwwAZcwCsOpkAQb2EAMIAAAHwAAHw8AG6EFBQUBAQEBAQE8PDwTKr/b3P1sHD/2lr/8GDA+INt0JAw1MAwZtAAJt0aLshmNMK+VFRUBgYGBgYG////ttr/yMr/2sL/8L7//Lzu/9C0/9qQ7OyS3PaeuP+iruq+nu/vvr6+CAgICAgI"});var Cr=c(function(Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:true});Ae.default="dHR0JBiMAACoRACcjAB0qAAQpAAAfAgAQCwAAEQAAFAAADwUGDxcAAAAAAAAAAAAvLy8AHDsIDjsgADwvAC85ABY2CgAyEwMiHAAAJQAAKgAAJA4AICIAAAAAAAAAAAA/Pz8PLz8XJT8zIj89Hj8/HS0/HRg/Jg48Lw8gNAQTNxIWPiYAOjYeHh4AAAAAAAA/Pz8qOT8xNT81Mj8/MT8/MTY/Lyw/Nio/OSg4PygqPC8sPzMnPzwxMTEAAAAAAAA"});var xr=c(function(ge){"use strict";Object.defineProperty(ge,"__esModule",{value:true});ge.default="bW1tACSSAADbbUnbkgBttgBttiQAkkkAbUkAJEkAAG0kAJIAAElJAAAAAAAAAAAAtra2AG3bAEn/kgD/tgD//wCS/wAA220Akm0AJJIAAJIAALZtAJKSJCQkAAAAAAAA////bbb/kpL/223//wD//23//5IA/7YA29sAbdsAAP8ASf/bAP//SUlJAAAAAAAA////ttv/27b//7b//5L//7a2/9uS//9J//9ttv9Jkv9tSf/bktv/kpKSAAAAAAAA"});var Or=c(function(ye){"use strict";Object.defineProperty(ye,"__esModule",{value:true});ye.default="ZmZmACqIFBKnOwCkXAB+bgBAbAcAVh0AMzUADEgAAFIAAE8IAEBNAAAAAAAAAAAAra2tFV/ZQkD/dSf+oBrMtx57tTEgmU4Aa20AOIcADZMAAI8yAHyNAAAAAAAAAAAA////ZLD/kpD/xnb/8mr//27M/4Fw6p4ivL4AiNgAXOQwReCCSM3eT09PAAAAAAAA////wN//09L/6Mj/+sL//8Tq/8zF99il5OWUz++WvfSrs/PMtevyuLi4AAAAAAAA"});var Fr=c(function(me){"use strict";Object.defineProperty(me,"__esModule",{value:true});me.default="WFhYACOMABObLQWFXQBSegAXeggAXxgANSoACTkAAD8AADwiADJdAAAAAAAAAAAAoaGhAFPuFTz+YCjkqR2Y1B5B0iwAqkQAbF4ALXMAAH0GAHhSAGmpAAAAAAAAAAAA////H6X+Xon+tXL+/mX2/meQ/nc8/pMIxLIAecoQOtVKEdGkBr/+QkJCAAAAAAAA////oNn+vcz+4cL+/rz7/r3Q/sWp/tGO6d6Gx+mSqO6wlezZkeT+rKysAAAAAAAA"});var Sr=c(function(Me){"use strict";Object.defineProperty(Me,"__esModule",{value:true});Me.default="a2trAB6HHwuWOwyHWQ1hXgUoVREARhsAMDIACkgAAE4AAEYZADpYAAAAAAAAAAAAsrKyGlPRSDXucSPsmh63pR5ipS0Zh0sAZ2kAKYQAA4sAAIJAAHiRAAAAAAAAAAAA////Y639kIr+uXf853H+92/J9YNq3ZwpvbgHhNEHW9w7SNd9SMzOVVVVAAAAAAAA////xOP+19X+5s3++cr+/snw/tHH99ys6Oic0fKdv/Sxt/XNt/Duvr6+AAAAAAAA"});var Pe=c(function(Z){"use strict";var Y=Z&&Z.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(Z,"__esModule",{value:true});Z.DEFAULT_PALETTE=void 0;Z.isPaletteName=nn;Z.createPalette=sn;Z.createPaletteVariant=un;var Ut=B();var Re=Vt();var Yo=Y(mr());var Qo=Y(Mr());var Ko=Y(Rr());var Wo=Y(Pr());var Zo=Y(vr());var Jo=Y(_r());var $o=Y(Cr());var tn=Y(xr());var en=Y(Or());var rn=Y(Fr());var on=Y(Sr());var Ct=64;var br={"asq-real-a":Yo.default,"asq-real-b":Qo.
default,"bmf-fin-r2":Ko.default,"bmf-fin-r3":Wo.default,"fceu-13":Zo.default,"fceu-15":Jo.default,"fceux":$o.default,"nestopia-rgb":tn.default,"nestopia-yuv":en.default,"sony-cxa2025as":rn.default,"unsaturated-v6":on.default};Z.DEFAULT_PALETTE="fceux";function nn(e){return e in br}function sn(e){if(e===void 0){e=Z.DEFAULT_PALETTE}var t=br[e];if(t){Ut.log.info('Creating "'.concat(e,'" palette'));return an(t)}throw new Error("Invalid palette: "+(0,Ut.describe)(e))}function an(e){var t=(0,Ut.decodeBase64)(
e);if(t.length!==Ct*3){throw new Error("Palette data does not contain ".concat(Ct," entries"))}var r=new Uint32Array(Ct);for(var o=0;o<Ct;o++){var s=3*o;var a=t[s];var P=t[s+1];var S=t[s+2];r[o]=(0,Re.packColor)(a,P,S)}return r}function un(e,t,r,o){Ut.log.info("Creating palette variant (".concat(t,", ").concat(r,", ").concat(o,")"));var s=new Uint32Array(Ct);for(var a=0;a<Ct;a++){var P=(0,Re.unpackColor)(e[a]),S=P[0],h=P[1],l=P[2];S=Math.floor(t*S);h=Math.floor(r*h);l=Math.floor(o*l);s[a]=(0,Re.
packColor)(S,h,l)}return s}});var Br=c(function(u){"use strict";Object.defineProperty(u,"__esModule",{value:true});u.SKIP=u.VB_END=u.VB_START2=u.VB_START=u.COPY_VS=u.COPY_HS=u.INC_FY=u.INC_CX=u.CLIP_TB=u.CLIP_LEFT=u.EVAL_SP=u.SHIFT_BG=u.COPY_BG=u.FETCH_SPH=u.FETCH_SPL=u.FETCH_BGH=u.FETCH_BGL=u.FETCH_AT=u.FETCH_NT=u.RENDER=void 0;u.compute=pn;u.RENDER=1<<1;u.FETCH_NT=1<<2;u.FETCH_AT=1<<3;u.FETCH_BGL=1<<4;u.FETCH_BGH=1<<5;u.FETCH_SPL=1<<6;u.FETCH_SPH=1<<7;u.COPY_BG=1<<8;u.SHIFT_BG=1<<9;u.EVAL_SP=1<<10;u.CLIP_LEFT=1<<11;u.CLIP_TB=
1<<12;u.INC_CX=1<<13;u.INC_FY=1<<14;u.COPY_HS=1<<15;u.COPY_VS=1<<16;u.VB_START=1<<17;u.VB_START2=1<<18;u.VB_END=1<<19;u.SKIP=1<<20;var w=new Uint32Array(262);for(p=0;p<w.length;p++){if(p<=239){w[p]|=u.RENDER;w[p]|=u.SHIFT_BG;w[p]|=u.CLIP_LEFT;w[p]|=u.EVAL_SP}if(p<=239||p===261){w[p]|=u.FETCH_NT;w[p]|=u.FETCH_AT;w[p]|=u.FETCH_BGL;w[p]|=u.FETCH_BGH;w[p]|=u.FETCH_SPL;w[p]|=u.FETCH_SPH;w[p]|=u.COPY_BG;w[p]|=u.INC_CX;w[p]|=u.INC_FY;w[p]|=u.COPY_HS}if(p<=7||p>=232&&p<=239){w[p]|=u.CLIP_TB}}var p;w[241]|=
u.VB_START;w[241]|=u.VB_START2;w[261]|=u.COPY_VS;w[261]|=u.VB_END;w[261]|=u.SKIP;var k=new Uint32Array(341);for(p=0;p<k.length;p++){if(p>=1&&p<=256){k[p]|=u.RENDER;k[p]|=u.CLIP_TB}if((p&7)===1||p===339){k[p]|=u.FETCH_NT}if((p&7)===3&&p!==339){k[p]|=u.FETCH_AT}if((p&7)===5){k[p]|=p<=256||p>=321?u.FETCH_BGL:u.FETCH_SPL}if((p&7)===7){k[p]|=p<=256||p>=321?u.FETCH_BGH:u.FETCH_SPH}if((p&7)===0&&p>=8&&p<=256||p===328||p===336){k[p]|=u.INC_CX}if((p&7)===1&&p>=9&&p<=257||p===329||p===337){k[p]|=u.COPY_BG}
if(p>=1&&p<=256||p>=321&&p<=336){k[p]|=u.SHIFT_BG}if(p>=280&&p<=304){k[p]|=u.COPY_VS}if(p>=1&&p<=8){k[p]|=u.CLIP_LEFT}if(p>=1&&p<=3){k[p]|=u.VB_START2}}var p;k[1]|=u.VB_START;k[1]|=u.VB_END;k[65]|=u.EVAL_SP;k[256]|=u.INC_FY;k[257]|=u.COPY_HS;k[338]|=u.SKIP;function pn(e,t){return w[e]&k[t]}});var wr=c(function(ve){"use strict";Object.defineProperty(ve,"__esModule",{value:true});var hn=function(){function e(){this.x=0;this.zeroSprite=false;this.horizontalFlip=false;this.paletteNumber=0;this.inFront=false;this.patternRowAddress=0;this.patternRow0=0;this.patternRow1=0}return e}();ve.default=hn});var Dr=c(function(Q){"use strict";var cn=Q&&Q.__createBinding||(Object.create?function(e,t,r,o){if(o===void 0)o=r;var s=Object.getOwnPropertyDescriptor(t,r);if(!s||("get"in s?!t.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,o,s)}:function(e,t,r,o){if(o===void 0)o=r;e[o]=t[r]});var ln=Q&&Q.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var fn=Q&&
Q.__importStar||function(){var e=function(t){e=Object.getOwnPropertyNames||function(r){var o=[];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s))o[o.length]=s;return o};return e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(t!=null){for(var o=e(t),s=0;s<o.length;s++)if(o[s]!=="default")cn(r,t,o[s])}ln(r,t);return r}}();var Er=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(Q,"__esModule",{value:true});var Dt=B();var dn=dt();
var It=ue();var An=Vt();var gn=Pe();var x=fn(Br());var yn=Er(wr());var la=Er(require("display"));var mn=function(){function e(){Dt.log.info("Initializing PPU");this.scanline=261;this.cycle=0;this.cycleFlags=0;this.oddFrame=false;this.addressBus=0;this.clipTopBottom=false;this.vblankActive=false;this.vblankSuppressed=false;this.nmiSuppressed=false;this.nmiDelay=0;this.frameBuffer=null;this.frameAvailable=false;this.framePosition=0;this.basePalette=null;this.paletteVariants=new Array(8);this.palette=
null;this.spriteCount=0;this.spriteNumber=0;this.spriteCache=new Array(261);this.spritePixelCache=new Uint8Array(261);this.primaryOAM=new Uint8Array(256);this.secondaryOAM=new Array(8);this.oamAddress=0;this.tempAddress=0;this.vramAddress=0;this.vramReadBuffer=0;this.writeToggle=false;this.fineXScroll=0;this.patternBuffer0=0;this.patternBuffer1=0;this.paletteBuffer0=0;this.paletteBuffer1=0;this.paletteLatch0=0;this.paletteLatch1=0;this.patternBufferNext0=0;this.patternBufferNext1=0;this.paletteLatchNext0=
0;this.paletteLatchNext1=0;this.patternRowAddress=0;this.bigAddressIncrement=0;this.spPatternTableAddress=0;this.bgPatternTableAddress=0;this.bigSprites=0;this.nmiEnabled=0;this.monochromeMode=0;this.backgroundClipping=0;this.spriteClipping=0;this.backgroundVisible=0;this.spritesVisible=0;this.colorEmphasis=0;this.spriteOverflow=0;this.spriteZeroHit=0;this.vblankFlag=0;this.cpu=null;this.ppuMemory=null}e.prototype.connect=function(t){Dt.log.info("Connecting PPU");this.cpu=t.cpu;this.ppuMemory=t.
ppuMemory};e.prototype.reset=function(){Dt.log.info("Resetting PPU");this.resetOAM();this.resetRegisters();this.resetState()};e.prototype.resetOAM=function(){this.primaryOAM.fill(0);for(var t=0;t<this.secondaryOAM.length;t++){this.secondaryOAM[t]=new yn.default}};e.prototype.resetRegisters=function(){this.setControl(0);this.setMask(0);this.setStatus(0);this.oamAddress=0;this.tempAddress=0;this.vramAddress=0;this.vramReadBuffer=0;this.writeToggle=false;this.fineXScroll=0;this.patternBuffer0=0;this.
patternBuffer1=0;this.paletteBuffer0=0;this.paletteBuffer1=0;this.paletteLatch0=0;this.paletteLatch1=0;this.patternBufferNext0=0;this.patternBufferNext1=0;this.paletteLatchNext0=0;this.paletteLatchNext1=0};e.prototype.resetState=function(){this.scanline=261;this.cycle=0;this.cycleFlags=0;this.vblankSuppressed=false;this.nmiSuppressed=false;this.nmiDelay=0;this.oddFrame=false;this.spriteCount=0;this.spriteNumber=0;this.clearSprites()};e.prototype.setRegionParams=function(t){Dt.log.info("Setting P\
PU region parameters");this.clipTopBottom=t.ppuClipTopBottom};e.prototype.setBasePalette=function(t){Dt.log.info("Setting PPU base palette");this.basePalette=t;this.createPaletteVariants();this.updatePalette()};e.prototype.getBasePalette=function(){return this.basePalette};e.prototype.createPaletteVariants=function(){for(var t=0;t<this.paletteVariants.length;t++){var r=t&6?.75:1;var o=t&5?.75:1;var s=t&3?.75:1;this.paletteVariants[t]=(0,gn.createPaletteVariant)(this.basePalette,r,o,s)}};e.prototype.
updatePalette=function(){this.palette=this.paletteVariants[this.colorEmphasis]};e.prototype.writeControl=function(t){var r=this.nmiEnabled;this.setControl(t);this.tempAddress=this.tempAddress&62463|(t&3)<<10;if(this.vblankFlag&&!r&&this.nmiEnabled&&!(this.cycleFlags&x.VB_END)){this.nmiDelay=1}};e.prototype.setControl=function(t){this.bigAddressIncrement=t>>>2&1;this.spPatternTableAddress=t<<9&4096;this.bgPatternTableAddress=t<<8&4096;this.bigSprites=t>>>5&1;this.nmiEnabled=t>>>7};e.prototype.writeMask=
function(t){this.setMask(t);this.updatePalette()};e.prototype.setMask=function(t){this.monochromeMode=t&1;this.backgroundClipping=~t>>>1&1;this.spriteClipping=~t>>>2&1;this.backgroundVisible=t>>>3&1;this.spritesVisible=t>>>4&1;this.colorEmphasis=t>>>5&7};e.prototype.readStatus=function(){var t=this.getStatus();this.vblankFlag=0;this.writeToggle=false;if(this.cycleFlags&x.VB_START){this.vblankSuppressed=true}if(this.cycleFlags&x.VB_START2){this.nmiSuppressed=true}return t};e.prototype.getStatus=function(){
return this.spriteOverflow<<5|this.spriteZeroHit<<6|this.vblankFlag<<7};e.prototype.setStatus=function(t){this.spriteOverflow=t>>>5&1;this.spriteZeroHit=t>>>6&1;this.vblankFlag=t>>>7};e.prototype.writeOAMAddress=function(t){this.oamAddress=t};e.prototype.readOAMData=function(){var t=this.primaryOAM[this.oamAddress];if((this.oamAddress&3)===2){t&=227}return t};e.prototype.writeOAMData=function(t){if(!this.isRenderingActive()){this.primaryOAM[this.oamAddress]=t}this.oamAddress=this.oamAddress+1&255};
e.prototype.writeAddress=function(t){this.writeToggle=!this.writeToggle;if(this.writeToggle){var r=(t&63)<<8;this.tempAddress=this.tempAddress&255|r}else{var o=t;this.tempAddress=this.tempAddress&65280|o;this.vramAddress=this.tempAddress}};e.prototype.readData=function(){if((this.vramAddress&16128)===16128){var t=this.ppuMemory.read(this.vramAddress);this.vramReadBuffer=this.ppuMemory.read(this.vramAddress&12287);this.incrementAddress();return t}var r=this.vramReadBuffer;this.vramReadBuffer=this.
ppuMemory.read(this.vramAddress);this.incrementAddress();return r};e.prototype.writeData=function(t){if(!this.isRenderingActive()){this.ppuMemory.write(this.vramAddress,t)}this.incrementAddress()};e.prototype.incrementAddress=function(){var t=this.bigAddressIncrement?32:1;this.vramAddress=this.vramAddress+t&65535};e.prototype.writeScroll=function(t){this.writeToggle=!this.writeToggle;if(this.writeToggle){this.fineXScroll=t&7;var r=t>>>3;this.tempAddress=this.tempAddress&65504|r}else{var o=(t&7)<<
12;var s=(t&248)<<2;this.tempAddress=this.tempAddress&3103|s|o}};e.prototype.updateScrolling=function(){if(this.cycleFlags&x.INC_CX){this.incrementCoarseXScroll()}if(this.cycleFlags&x.INC_FY){this.incrementFineYScroll()}if(this.cycleFlags&x.COPY_HS){this.copyHorizontalScrollBits()}if(this.cycleFlags&x.COPY_VS){this.copyVerticalScrollBits()}};e.prototype.copyHorizontalScrollBits=function(){this.vramAddress=this.vramAddress&31712|this.tempAddress&1055};e.prototype.copyVerticalScrollBits=function(){
this.vramAddress=this.vramAddress&1055|this.tempAddress&31712};e.prototype.incrementCoarseXScroll=function(){if((this.vramAddress&31)===31){this.vramAddress&=65504;this.vramAddress^=1024}else{this.vramAddress+=1}};e.prototype.incrementFineYScroll=function(){if((this.vramAddress&28672)===28672){this.vramAddress&=4095;this.incrementCoarseYScroll()}else{this.vramAddress+=4096}};e.prototype.incrementCoarseYScroll=function(){if((this.vramAddress&992)===992){this.vramAddress&=64543}else if((this.vramAddress&
992)===928){this.vramAddress&=64543;this.vramAddress^=2048}else{this.vramAddress+=32}};e.prototype.setFrameBuffer=function(t){this.frameBuffer=t;this.framePosition=0;this.frameAvailable=false};e.prototype.isFrameAvailable=function(){return this.frameAvailable};e.prototype.setFramePixel=function(t){var r=this.framePosition%It.VIDEO_WIDTH;var o=Math.floor(this.framePosition/It.VIDEO_WIDTH);this.frameBuffer.drawPixel(r,o,this.palette[t&63]);this.framePosition++};e.prototype.setFramePixelOnPosition=
function(t,r,o){this.frameBuffer.drawPixel(t,r,this.palette[o&63])};e.prototype.clearFramePixel=function(){var t=this.framePosition%It.VIDEO_WIDTH;var r=Math.floor(this.framePosition/It.VIDEO_WIDTH);this.frameBuffer.drawPixel(t,r,An.BLACK_COLOR);this.framePosition++};e.prototype.updateVBlank=function(){if(this.nmiDelay){if(!this.nmiEnabled){this.nmiDelay=0}else if(!--this.nmiDelay&&!this.nmiSuppressed){this.cpu.activateInterrupt(dn.NMI)}}if(this.cycleFlags&x.VB_START){this.enterVBlank()}else if(this.
cycleFlags&x.VB_END){this.leaveVBlank()}};e.prototype.enterVBlank=function(){if(!this.vblankSuppressed){this.vblankFlag=1}this.vblankActive=true;this.frameAvailable=true;this.nmiDelay=2};e.prototype.leaveVBlank=function(){this.vblankActive=false;this.vblankFlag=0;this.vblankSuppressed=false;this.nmiSuppressed=false;this.spriteZeroHit=0;this.spriteOverflow=0};e.prototype.incrementCycle=function(){if(this.cycleFlags&x.SKIP&&this.oddFrame&&this.isRenderingEnabled()){this.cycle++}this.cycle++;if(this.
cycle>340){this.incrementScanline()}this.cycleFlags=x.compute(this.scanline,this.cycle)};e.prototype.incrementScanline=function(){this.cycle=0;this.scanline++;if(this.scanline>261){this.incrementFrame()}if(this.scanline<=239){this.clearSprites();if(this.scanline>0){this.preRenderSprites()}}};e.prototype.incrementFrame=function(){this.scanline=0;this.oddFrame=!this.oddFrame;this.framePosition=0};e.prototype.tick=function(){if(this.isRenderingEnabled()){this.fetchData();this.doRendering();this.updateScrolling()}else{
this.skipRendering();this.addressBus=this.vramAddress}this.updateVBlank();this.incrementCycle()};e.prototype.fetchData=function(){if(this.cycleFlags&x.FETCH_NT){this.fetchNametable()}else if(this.cycleFlags&x.FETCH_AT){this.fetchAttribute()}else if(this.cycleFlags&x.FETCH_BGL){this.fetchBackgroundLow()}else if(this.cycleFlags&x.FETCH_BGH){this.fetchBackgroundHigh()}else if(this.cycleFlags&x.FETCH_SPL){this.fetchSpriteLow()}else if(this.cycleFlags&x.FETCH_SPH){this.fetchSpriteHigh()}};e.prototype.
doRendering=function(){if(this.cycleFlags&x.EVAL_SP){this.evaluateSprites()}if(this.cycleFlags&x.COPY_BG){this.copyBackground()}if(this.cycleFlags&x.RENDER){this.updateFramePixel()}if(this.cycleFlags&x.SHIFT_BG){this.shiftBackground()}};e.prototype.skipRendering=function(){if(this.cycleFlags&x.RENDER){this.clearFramePixel()}};e.prototype.isRenderingActive=function(){return!this.vblankActive&&this.isRenderingEnabled()};e.prototype.isRenderingEnabled=function(){return this.spritesVisible||this.backgroundVisible};
e.prototype.updateFramePixel=function(){var t=this.renderFramePixel();if(this.clipTopBottom&&this.cycleFlags&x.CLIP_TB){this.clearFramePixel()}else{var r=this.ppuMemory.readPalette(t);this.setFramePixel(r)}};e.prototype.renderFramePixel=function(){var t=this.renderBackgroundPixel();var r=this.renderSpritePixel();if(t&3){if(r&3){var o=this.getRenderedSprite();if(o.zeroSprite&&this.cycle!==256){this.spriteZeroHit=1}if(o.inFront){return r}}return t}if(r&3){return r}return 0};e.prototype.fetchNametable=
function(){this.addressBus=8192|this.vramAddress&4095;var t=this.ppuMemory.readNametable(this.addressBus);var r=this.bgPatternTableAddress+(t<<4);var o=this.vramAddress>>>12&7;this.patternRowAddress=r+o};e.prototype.fetchAttribute=function(){var t=9152|this.vramAddress&3072;var r=this.vramAddress>>>4&56|this.vramAddress>>>2&7;this.addressBus=t+r;var o=this.ppuMemory.readNametable(this.addressBus);var s=this.vramAddress>>>4&4|this.vramAddress&2;var a=o>>>s&3;this.paletteLatchNext0=a&1;this.paletteLatchNext1=
a>>>1&1};e.prototype.fetchBackgroundLow=function(){this.addressBus=this.patternRowAddress;this.patternBufferNext0=this.ppuMemory.readPattern(this.addressBus)};e.prototype.fetchBackgroundHigh=function(){this.addressBus=this.patternRowAddress+8;this.patternBufferNext1=this.ppuMemory.readPattern(this.addressBus)};e.prototype.copyBackground=function(){this.patternBuffer0|=this.patternBufferNext0;this.patternBuffer1|=this.patternBufferNext1;this.paletteLatch0=this.paletteLatchNext0;this.paletteLatch1=
this.paletteLatchNext1};e.prototype.shiftBackground=function(){this.patternBuffer0=this.patternBuffer0<<1;this.patternBuffer1=this.patternBuffer1<<1;this.paletteBuffer0=this.paletteBuffer0<<1|this.paletteLatch0;this.paletteBuffer1=this.paletteBuffer1<<1|this.paletteLatch1};e.prototype.renderBackgroundPixel=function(){if(this.isBackgroundPixelVisible()){var t=this.patternBuffer0<<this.fineXScroll>>15&1;var r=this.patternBuffer1<<this.fineXScroll>>14&2;var o=this.paletteBuffer0<<this.fineXScroll>>
5&4;var s=this.paletteBuffer1<<this.fineXScroll>>4&8;return s|o|r|t}return 0};e.prototype.isBackgroundPixelVisible=function(){return this.backgroundVisible&&!(this.backgroundClipping&&this.cycleFlags&x.CLIP_LEFT)};e.prototype.evaluateSprites=function(){this.spriteNumber=0;this.spriteCount=0;var t=this.bigSprites?16:8;var r=this.scanline+1;var o=r-t+1;for(var s=0;s<this.primaryOAM.length;s+=4){var a=this.primaryOAM[s]+1;if(a<o||a>r){continue}if(this.spriteCount>=8){this.spriteOverflow=1;break}var P=this.
spPatternTableAddress;var S=this.primaryOAM[s+1];if(this.bigSprites){P=(S&1)<<12;S&=254}var h=this.primaryOAM[s+2];var l=r-a;if(h&128){l=t-l-1}if(l>=8){l-=8;S++}var b=this.secondaryOAM[this.spriteCount];b.x=this.primaryOAM[s+3];b.zeroSprite=s===0;b.horizontalFlip=h&64;b.paletteNumber=16|(h&3)<<2;b.inFront=(h&32)===0;var M=P+(S<<4);b.patternRowAddress=M+l;this.spriteCount++}};e.prototype.fetchSpriteLow=function(){if(this.spriteNumber<this.spriteCount){var t=this.secondaryOAM[this.spriteNumber];this.
addressBus=t.patternRowAddress;t.patternRow0=this.ppuMemory.readPattern(this.addressBus)}else{this.addressBus=this.spPatternTableAddress|4080}};e.prototype.fetchSpriteHigh=function(){if(this.spriteNumber<this.spriteCount){var t=this.secondaryOAM[this.spriteNumber++];this.addressBus=t.patternRowAddress+8;t.patternRow1=this.ppuMemory.readPattern(this.addressBus)}else{this.addressBus=this.spPatternTableAddress|4080}};e.prototype.clearSprites=function(){this.spriteCache.fill(null);this.spritePixelCache.
fill(0)};e.prototype.preRenderSprites=function(){for(var t=0;t<this.spriteCount;t++){var r=this.secondaryOAM[t];for(var o=0;o<8;o++){var s=r.x+o+1;if(s>It.VIDEO_WIDTH){break}if(this.spriteCache[s]){continue}var a=r.horizontalFlip?o:o^7;var P=r.patternRow0>>>a&1;var S=(r.patternRow1>>>a&1)<<1;var h=S|P;if(h){this.spriteCache[s]=r;this.spritePixelCache[s]=r.paletteNumber|h}}}};e.prototype.renderSpritePixel=function(){if(this.isSpritePixelVisible()){return this.spritePixelCache[this.cycle]}return 0};
e.prototype.isSpritePixelVisible=function(){return this.spritesVisible&&!(this.spriteClipping&&this.cycleFlags&x.CLIP_LEFT)};e.prototype.getRenderedSprite=function(){return this.spriteCache[this.cycle]};e.prototype.renderDebugFrame=function(){this.renderPatterns();this.renderPalettes()};e.prototype.renderPatterns=function(){for(var t=0;t<16;t++){var r=t<<3;for(var o=0;o<32;o++){var s=o<<3;var a=((o&16)<<4|t<<4|o&15)<<4;this.renderPatternTile(s,r,a)}}};e.prototype.renderPatternTile=function(t,r,o){
for(var s=0;s<8;s++){var a=r+s;var P=this.ppuMemory.readPattern(o+s);var S=this.ppuMemory.readPattern(o+s+8);for(var h=0;h<8;h++){var l=t+h;var b=h^7;var M=P>>b&1;var T=(S>>b&1)<<1;var N=this.ppuMemory.readPalette(T|M);this.setFramePixelOnPosition(l,a,N)}}};e.prototype.renderPalettes=function(){for(var t=0;t<4;t++){var r=t*28+128;for(var o=0;o<8;o++){var s=o<<5;var a=this.ppuMemory.readPalette(t<<3|o);this.renderPaletteTile(s,r,a)}}};e.prototype.renderPaletteTile=function(t,r,o){for(var s=r;s<r+
28;s++){for(var a=t;a<t+32;a++){this.setFramePixelOnPosition(a,s,o)}}};return e}();Q.default=mn});var Gt=c(function(E){"use strict";var Mn=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(E,"__esModule",{value:true});E.DEFAULT_PALETTE=E.isPaletteName=E.createPalette=E.BLACK_COLOR=E.unpackColor=E.packColor=E.VIDEO_HEIGHT=E.VIDEO_WIDTH=E.PPU=void 0;var Rn=Dr();Object.defineProperty(E,"PPU",{enumerable:true,get:function(){return Mn(Rn).default}});var Ir=ue();Object.defineProperty(E,"VIDEO_WIDTH",{enumerable:true,get:function(){return Ir.VIDEO_WIDTH}});
Object.defineProperty(E,"VIDEO_HEIGHT",{enumerable:true,get:function(){return Ir.VIDEO_HEIGHT}});var _e=Vt();Object.defineProperty(E,"packColor",{enumerable:true,get:function(){return _e.packColor}});Object.defineProperty(E,"unpackColor",{enumerable:true,get:function(){return _e.unpackColor}});Object.defineProperty(E,"BLACK_COLOR",{enumerable:true,get:function(){return _e.BLACK_COLOR}});var Ce=Pe();Object.defineProperty(E,"createPalette",{enumerable:true,get:function(){return Ce.createPalette}});
Object.defineProperty(E,"isPaletteName",{enumerable:true,get:function(){return Ce.isPaletteName}});Object.defineProperty(E,"DEFAULT_PALETTE",{enumerable:true,get:function(){return Ce.DEFAULT_PALETTE}})});var Hr=c(function(xe){"use strict";Object.defineProperty(xe,"__esModule",{value:true});var Yt=B();var kt=dt();var D=1<<0;var v=1<<1;var Pn=65532;var kr=65530;var Lr=65534;var n=new Array(255);var Nr=function(){function e(){Yt.log.info("Initializing CPU");this.halted=false;this.operationFlags=0;this.activeInterrupts=0;this.irqDisabled=0;this.pageCrossed=0;this.programCounter=0;this.stackPointer=0;this.accumulator=0;this.registerX=0;this.registerY=0;this.carryFlag=0;this.zeroFlag=0;this.interruptFlag=
0;this.decimalFlag=0;this.overflowFlag=0;this.negativeFlag=0;this.mapper=null;this.cpuMemory=null;this.dma=null;this.ppu=null;this.apu=null}e.prototype.connect=function(t){Yt.log.info("Connecting CPU");this.cpuMemory=t.cpuMemory;this.ppu=t.ppu;this.apu=t.apu;this.dma=t.dma};e.prototype.setMapper=function(t){this.mapper=t};e.prototype.reset=function(){Yt.log.info("Resetting CPU");this.resetState();this.resetMemory();this.handleReset()};e.prototype.resetState=function(){this.activeInterrupts=0;this.
halted=false;this.stackPointer=0;this.accumulator=0;this.registerX=0;this.registerY=0;this.setStatus(0)};e.prototype.resetMemory=function(){for(var t=0;t<8;t++){this.cpuMemory.write(t,255)}this.cpuMemory.write(8,247);this.cpuMemory.write(9,239);this.cpuMemory.write(10,223);this.cpuMemory.write(15,191);for(var t=16;t<2048;t++){this.cpuMemory.write(t,255)}for(var t=16384;t<16400;t++){this.cpuMemory.write(t,0)}};e.prototype.step=function(){var t=this.dma.isBlockingCPU()||this.apu.isBlockingCPU();if(this.
activeInterrupts&&!t){this.resolveInterrupt()}if(this.halted||t){this.tick()}else{this.readAndExecuteOperation()}};e.prototype.resolveInterrupt=function(){if(this.activeInterrupts&kt.RESET){this.handleReset()}else if(this.activeInterrupts&kt.NMI){this.handleNMI()}else if(this.irqDisabled){return}else{this.handleIRQ()}this.tick();this.tick()};e.prototype.handleReset=function(){this.writeByte(16405,0);this.writeByte(16407,this.apu.frameCounterLast);this.stackPointer=this.stackPointer-3&255;this.enterInterruptHandler(
Pn);this.clearInterrupt(kt.RESET);this.tick();this.halted=false};e.prototype.handleNMI=function(){this.saveStateBeforeInterrupt();this.enterInterruptHandler(kr);this.clearInterrupt(kt.NMI)};e.prototype.handleIRQ=function(){this.saveStateBeforeInterrupt();this.enterInterruptHandler(Lr)};e.prototype.saveStateBeforeInterrupt=function(){this.pushWord(this.programCounter);this.pushByte(this.getStatus())};e.prototype.enterInterruptHandler=function(t){this.interruptFlag=1;this.programCounter=this.readWord(
t)};e.prototype.readAndExecuteOperation=function(){var t=this.readOperation();if(t){this.beforeOperation(t);this.executeOperation(t)}else{Yt.log.warn("CPU halted!");this.halted=true}};e.prototype.beforeOperation=function(t){this.irqDisabled=this.interruptFlag;this.operationFlags=t[2]};e.prototype.executeOperation=function(t){var r=t[0],o=t[1];var s=o.call(this);r.call(this,s)};e.prototype.readOperation=function(){return n[this.readNextProgramByte()]};e.prototype.readNextProgramByte=function(){return this.
readByte(this.moveProgramCounter(1))};e.prototype.readNextProgramWord=function(){return this.readWord(this.moveProgramCounter(2))};e.prototype.moveProgramCounter=function(t){var r=this.programCounter;this.programCounter=this.programCounter+t&65535;return r};e.prototype.readByte=function(t){this.tick();return this.cpuMemory.read(t)};e.prototype.readWord=function(t){var r=t+1&65535;var o=this.readByte(t);var s=this.readByte(r);return s<<8|o};e.prototype.readWordFromSamePage=function(t){var r=t&65280|
t+1&255;var o=this.readByte(t);var s=this.readByte(r);return s<<8|o};e.prototype.writeByte=function(t,r){this.tick();this.cpuMemory.write(t,r);return r};e.prototype.writeWord=function(t,r){this.writeByte(t,r&255);return this.writeByte(t+1&65535,r>>>8)};e.prototype.readWriteByte=function(t){var r=this.readByte(t);return this.writeByte(t,r)};e.prototype.pushByte=function(t){this.writeByte(256+this.stackPointer,t);this.stackPointer=this.stackPointer-1&255};e.prototype.pushWord=function(t){this.pushByte(
t>>>8);this.pushByte(t&255)};e.prototype.popByte=function(){this.stackPointer=this.stackPointer+1&255;return this.readByte(256+this.stackPointer)};e.prototype.popWord=function(){return this.popByte()|this.popByte()<<8};e.prototype.getStatus=function(){return this.carryFlag|this.zeroFlag<<1|this.interruptFlag<<2|this.decimalFlag<<3|1<<5|this.overflowFlag<<6|this.negativeFlag<<7};e.prototype.setStatus=function(t){this.carryFlag=t&1;this.zeroFlag=t>>>1&1;this.interruptFlag=t>>>2&1;this.decimalFlag=
t>>>3&1;this.overflowFlag=t>>>6&1;this.negativeFlag=t>>>7};e.prototype.activateInterrupt=function(t){this.activeInterrupts|=t};e.prototype.clearInterrupt=function(t){this.activeInterrupts&=~t};e.prototype.tick=function(){if(!this.apu.isBlockingDMA()){this.dma.tick();this.mapper.tick()}this.ppu.tick();this.ppu.tick();this.ppu.tick();this.apu.tick()};e.prototype.impliedMode=function(){this.tick()};e.prototype.accumulatorMode=function(){this.tick()};e.prototype.immediateMode=function(){return this.
moveProgramCounter(1)};e.prototype.zeroPageMode=function(){return this.readNextProgramByte()};e.prototype.zeroPageXMode=function(){return this.computeZeroPageAddress(this.readNextProgramByte(),this.registerX)};e.prototype.zeroPageYMode=function(){return this.computeZeroPageAddress(this.readNextProgramByte(),this.registerY)};e.prototype.absoluteMode=function(){return this.readNextProgramWord()};e.prototype.absoluteXMode=function(){return this.computeAbsoluteAddress(this.readNextProgramWord(),this.
registerX)};e.prototype.absoluteYMode=function(){return this.computeAbsoluteAddress(this.readNextProgramWord(),this.registerY)};e.prototype.relativeMode=function(){var t=this.readNextProgramByte();var r=t&128?t-256:t;return this.programCounter+r&65535};e.prototype.indirectMode=function(){return this.readWordFromSamePage(this.readNextProgramWord())};e.prototype.indirectXMode=function(){return this.readWordFromSamePage(this.zeroPageXMode())};e.prototype.indirectYMode=function(){var t=this.readWordFromSamePage(
this.readNextProgramByte());return this.computeAbsoluteAddress(t,this.registerY)};e.prototype.computeZeroPageAddress=function(t,r){this.readByte(t);return t+r&255};e.prototype.computeAbsoluteAddress=function(t,r){var o=t+r&65535;this.pageCrossed=Tr(t,o);if(this.operationFlags&v||this.pageCrossed){this.readByte(t&65280|o&255)}return o};e.prototype.NOP=function(){if(this.operationFlags&D){this.tick()}};e.prototype.CLC=function(){this.carryFlag=0};e.prototype.CLI=function(){this.irqDisabled=this.interruptFlag;
this.interruptFlag=0};e.prototype.CLD=function(){this.decimalFlag=0};e.prototype.CLV=function(){this.overflowFlag=0};e.prototype.SEC=function(){this.carryFlag=1};e.prototype.SEI=function(){this.irqDisabled=this.interruptFlag;this.interruptFlag=1};e.prototype.SED=function(){this.decimalFlag=1};e.prototype.STA=function(t){this.writeByte(t,this.accumulator)};e.prototype.STX=function(t){this.writeByte(t,this.registerX)};e.prototype.SAX=function(t){this.writeByte(t,this.accumulator&this.registerX)};e.
prototype.STY=function(t){this.writeByte(t,this.registerY)};e.prototype.SHA=function(t){this.storeHighAddressIntoMemory(t,this.accumulator&this.registerX)};e.prototype.SHX=function(t){this.storeHighAddressIntoMemory(t,this.registerX)};e.prototype.SHY=function(t){this.storeHighAddressIntoMemory(t,this.registerY)};e.prototype.LDA=function(t){this.storeValueIntoAccumulator(this.readByte(t))};e.prototype.LDX=function(t){this.storeValueIntoRegisterX(this.readByte(t))};e.prototype.LDY=function(t){this.
storeValueIntoRegisterY(this.readByte(t))};e.prototype.LAX=function(t){var r=this.readByte(t);this.storeValueIntoAccumulator(r);this.storeValueIntoRegisterX(r)};e.prototype.LAS=function(t){this.stackPointer&=this.readByte(t);this.storeValueIntoAccumulator(this.stackPointer);this.storeValueIntoRegisterX(this.stackPointer)};e.prototype.TAX=function(){this.storeValueIntoRegisterX(this.accumulator)};e.prototype.TAY=function(){this.storeValueIntoRegisterY(this.accumulator)};e.prototype.TXA=function(){
this.storeValueIntoAccumulator(this.registerX)};e.prototype.TYA=function(){this.storeValueIntoAccumulator(this.registerY)};e.prototype.TSX=function(){this.storeValueIntoRegisterX(this.stackPointer)};e.prototype.TXS=function(){this.stackPointer=this.registerX};e.prototype.PHA=function(){this.pushByte(this.accumulator)};e.prototype.PHP=function(){this.pushByte(this.getStatus()|16)};e.prototype.PLA=function(){this.tick();this.storeValueIntoAccumulator(this.popByte())};e.prototype.PLP=function(){this.
tick();this.irqDisabled=this.interruptFlag;this.setStatus(this.popByte())};e.prototype.AND=function(t){return this.storeValueIntoAccumulator(this.accumulator&this.readByte(t))};e.prototype.ORA=function(t){this.storeValueIntoAccumulator(this.accumulator|this.readByte(t))};e.prototype.EOR=function(t){this.storeValueIntoAccumulator(this.accumulator^this.readByte(t))};e.prototype.BIT=function(t){var r=this.readByte(t);this.zeroFlag=!(this.accumulator&r)|0;this.overflowFlag=r>>>6&1;this.negativeFlag=
r>>>7};e.prototype.INC=function(t){return this.storeValueIntoMemory(t,this.readWriteByte(t)+1&255)};e.prototype.INX=function(){this.storeValueIntoRegisterX(this.registerX+1&255)};e.prototype.INY=function(){this.storeValueIntoRegisterY(this.registerY+1&255)};e.prototype.DEC=function(t){return this.storeValueIntoMemory(t,this.readWriteByte(t)-1&255)};e.prototype.DEX=function(){this.storeValueIntoRegisterX(this.registerX-1&255)};e.prototype.DEY=function(){this.storeValueIntoRegisterY(this.registerY-
1&255)};e.prototype.CMP=function(t){this.compareRegisterAndMemory(this.accumulator,t)};e.prototype.CPX=function(t){this.compareRegisterAndMemory(this.registerX,t)};e.prototype.CPY=function(t){this.compareRegisterAndMemory(this.registerY,t)};e.prototype.BCC=function(t){this.branchIf(!this.carryFlag,t)};e.prototype.BCS=function(t){this.branchIf(this.carryFlag,t)};e.prototype.BNE=function(t){this.branchIf(!this.zeroFlag,t)};e.prototype.BEQ=function(t){this.branchIf(this.zeroFlag,t)};e.prototype.BVC=
function(t){this.branchIf(!this.overflowFlag,t)};e.prototype.BVS=function(t){this.branchIf(this.overflowFlag,t)};e.prototype.BPL=function(t){this.branchIf(!this.negativeFlag,t)};e.prototype.BMI=function(t){this.branchIf(this.negativeFlag,t)};e.prototype.JMP=function(t){this.programCounter=t};e.prototype.JSR=function(t){this.tick();this.pushWord(this.programCounter-1&65535);this.programCounter=t};e.prototype.RTS=function(){this.tick();this.tick();this.programCounter=this.popWord()+1&65535};e.prototype.
BRK=function(){this.moveProgramCounter(1);this.pushWord(this.programCounter);this.pushByte(this.getStatus()|16);this.irqDisabled=1;this.interruptFlag=1;this.programCounter=this.readWord(this.activeInterrupts&kt.NMI?kr:Lr)};e.prototype.RTI=function(){this.tick();this.setStatus(this.popByte());this.irqDisabled=this.interruptFlag;this.programCounter=this.popWord()};e.prototype.ADC=function(t){this.addValueToAccumulator(this.readByte(t))};e.prototype.SBC=function(t){this.addValueToAccumulator(this.readByte(
t)^255)};e.prototype.ASL=function(t){return this.rotateAccumulatorOrMemory(t,this.rotateLeft,false)};e.prototype.LSR=function(t){return this.rotateAccumulatorOrMemory(t,this.rotateRight,false)};e.prototype.ROL=function(t){return this.rotateAccumulatorOrMemory(t,this.rotateLeft,true)};e.prototype.ROR=function(t){return this.rotateAccumulatorOrMemory(t,this.rotateRight,true)};e.prototype.DCP=function(t){this.compareRegisterAndOperand(this.accumulator,this.DEC(t))};e.prototype.ISB=function(t){this.
addValueToAccumulator(this.INC(t)^255)};e.prototype.SLO=function(t){this.storeValueIntoAccumulator(this.accumulator|this.ASL(t))};e.prototype.SRE=function(t){this.storeValueIntoAccumulator(this.accumulator^this.LSR(t))};e.prototype.RLA=function(t){this.storeValueIntoAccumulator(this.accumulator&this.ROL(t))};e.prototype.XAA=function(t){this.storeValueIntoAccumulator(this.registerX&this.AND(t))};e.prototype.RRA=function(t){this.addValueToAccumulator(this.ROR(t))};e.prototype.AXS=function(t){this.
registerX=this.compareRegisterAndMemory(this.accumulator&this.registerX,t)};e.prototype.ANC=function(t){this.rotateLeft(this.AND(t),false)};e.prototype.ALR=function(t){this.AND(t);this.LSR(null)};e.prototype.ARR=function(t){this.AND(t);this.ROR(null);this.carryFlag=this.accumulator>>>6&1;this.overflowFlag=this.accumulator>>>5&1^this.carryFlag};e.prototype.TAS=function(t){this.stackPointer=this.accumulator&this.registerX;this.SHA(t)};e.prototype.storeValueIntoAccumulator=function(t){this.updateZeroAndNegativeFlag(
t);return this.accumulator=t};e.prototype.storeValueIntoRegisterX=function(t){this.updateZeroAndNegativeFlag(t);this.registerX=t};e.prototype.storeValueIntoRegisterY=function(t){this.updateZeroAndNegativeFlag(t);this.registerY=t};e.prototype.storeValueIntoMemory=function(t,r){this.updateZeroAndNegativeFlag(r);return this.writeByte(t,r)};e.prototype.storeHighAddressIntoMemory=function(t,r){if(this.pageCrossed){this.writeByte(t,this.cpuMemory.read(t))}else{this.writeByte(t,r&(t>>>8)+1)}};e.prototype.
addValueToAccumulator=function(t){var r=this.accumulator+t+this.carryFlag;this.carryFlag=r>>>8&1;this.overflowFlag=((this.accumulator^r)&(t^r))>>>7&1;return this.storeValueIntoAccumulator(r&255)};e.prototype.compareRegisterAndMemory=function(t,r){return this.compareRegisterAndOperand(t,this.readByte(r))};e.prototype.compareRegisterAndOperand=function(t,r){var o=t-r;this.carryFlag=o>=0|0;this.updateZeroAndNegativeFlag(o);return o&255};e.prototype.branchIf=function(t,r){if(t){this.tick();if(Tr(this.
programCounter,r)){this.tick()}this.programCounter=r}};e.prototype.rotateAccumulatorOrMemory=function(t,r,o){if(t!=null){var s=r.call(this,this.readWriteByte(t),o);return this.storeValueIntoMemory(t,s)}var a=r.call(this,this.accumulator,o);return this.storeValueIntoAccumulator(a)};e.prototype.rotateLeft=function(t,r){var o=r&this.carryFlag;this.carryFlag=t>>>7;return(t<<1|o)&255};e.prototype.rotateRight=function(t,r){var o=(r&this.carryFlag)<<7;this.carryFlag=t&1;return t>>>1|o};e.prototype.updateZeroAndNegativeFlag=
function(t){this.zeroFlag=!(t&255)|0;this.negativeFlag=t>>>7&1};return e}();xe.default=Nr;function Tr(e,t){return(e&65280)!==(t&65280)}var i=Nr.prototype;n[26]=[i.NOP,i.impliedMode,0];n[58]=[i.NOP,i.impliedMode,0];n[90]=[i.NOP,i.impliedMode,0];n[122]=[i.NOP,i.impliedMode,0];n[218]=[i.NOP,i.impliedMode,0];n[234]=[i.NOP,i.impliedMode,0];n[250]=[i.NOP,i.impliedMode,0];n[128]=[i.NOP,i.immediateMode,D];n[130]=[i.NOP,i.immediateMode,D];n[137]=[i.NOP,i.immediateMode,D];n[194]=[i.NOP,i.immediateMode,D];
n[226]=[i.NOP,i.immediateMode,D];n[4]=[i.NOP,i.zeroPageMode,D];n[68]=[i.NOP,i.zeroPageMode,D];n[100]=[i.NOP,i.zeroPageMode,D];n[20]=[i.NOP,i.zeroPageXMode,D];n[52]=[i.NOP,i.zeroPageXMode,D];n[84]=[i.NOP,i.zeroPageXMode,D];n[116]=[i.NOP,i.zeroPageXMode,D];n[212]=[i.NOP,i.zeroPageXMode,D];n[244]=[i.NOP,i.zeroPageXMode,D];n[12]=[i.NOP,i.absoluteMode,D];n[28]=[i.NOP,i.absoluteXMode,D];n[60]=[i.NOP,i.absoluteXMode,D];n[92]=[i.NOP,i.absoluteXMode,D];n[124]=[i.NOP,i.absoluteXMode,D];n[220]=[i.NOP,i.absoluteXMode,
D];n[252]=[i.NOP,i.absoluteXMode,D];n[24]=[i.CLC,i.impliedMode,0];n[88]=[i.CLI,i.impliedMode,0];n[216]=[i.CLD,i.impliedMode,0];n[184]=[i.CLV,i.impliedMode,0];n[56]=[i.SEC,i.impliedMode,0];n[120]=[i.SEI,i.impliedMode,0];n[248]=[i.SED,i.impliedMode,0];n[133]=[i.STA,i.zeroPageMode,0];n[149]=[i.STA,i.zeroPageXMode,0];n[141]=[i.STA,i.absoluteMode,0];n[157]=[i.STA,i.absoluteXMode,v];n[153]=[i.STA,i.absoluteYMode,v];n[129]=[i.STA,i.indirectXMode,0];n[145]=[i.STA,i.indirectYMode,v];n[134]=[i.STX,i.zeroPageMode,
0];n[150]=[i.STX,i.zeroPageYMode,0];n[142]=[i.STX,i.absoluteMode,0];n[135]=[i.SAX,i.zeroPageMode,0];n[151]=[i.SAX,i.zeroPageYMode,0];n[143]=[i.SAX,i.absoluteMode,0];n[131]=[i.SAX,i.indirectXMode,0];n[132]=[i.STY,i.zeroPageMode,0];n[148]=[i.STY,i.zeroPageXMode,0];n[140]=[i.STY,i.absoluteMode,0];n[147]=[i.SHA,i.indirectYMode,v];n[159]=[i.SHA,i.absoluteYMode,v];n[158]=[i.SHX,i.absoluteYMode,v];n[156]=[i.SHY,i.absoluteXMode,v];n[169]=[i.LDA,i.immediateMode,0];n[165]=[i.LDA,i.zeroPageMode,0];n[181]=[
i.LDA,i.zeroPageXMode,0];n[173]=[i.LDA,i.absoluteMode,0];n[189]=[i.LDA,i.absoluteXMode,0];n[185]=[i.LDA,i.absoluteYMode,0];n[161]=[i.LDA,i.indirectXMode,0];n[177]=[i.LDA,i.indirectYMode,0];n[162]=[i.LDX,i.immediateMode,0];n[166]=[i.LDX,i.zeroPageMode,0];n[182]=[i.LDX,i.zeroPageYMode,0];n[174]=[i.LDX,i.absoluteMode,0];n[190]=[i.LDX,i.absoluteYMode,0];n[160]=[i.LDY,i.immediateMode,0];n[164]=[i.LDY,i.zeroPageMode,0];n[180]=[i.LDY,i.zeroPageXMode,0];n[172]=[i.LDY,i.absoluteMode,0];n[188]=[i.LDY,i.absoluteXMode,
0];n[171]=[i.LAX,i.immediateMode,0];n[167]=[i.LAX,i.zeroPageMode,0];n[183]=[i.LAX,i.zeroPageYMode,0];n[175]=[i.LAX,i.absoluteMode,0];n[191]=[i.LAX,i.absoluteYMode,0];n[163]=[i.LAX,i.indirectXMode,0];n[179]=[i.LAX,i.indirectYMode,0];n[187]=[i.LAS,i.absoluteYMode,0];n[170]=[i.TAX,i.impliedMode,0];n[168]=[i.TAY,i.impliedMode,0];n[138]=[i.TXA,i.impliedMode,0];n[152]=[i.TYA,i.impliedMode,0];n[154]=[i.TXS,i.impliedMode,0];n[186]=[i.TSX,i.impliedMode,0];n[72]=[i.PHA,i.impliedMode,0];n[8]=[i.PHP,i.impliedMode,
0];n[104]=[i.PLA,i.impliedMode,0];n[40]=[i.PLP,i.impliedMode,0];n[41]=[i.AND,i.immediateMode,0];n[37]=[i.AND,i.zeroPageMode,0];n[53]=[i.AND,i.zeroPageXMode,0];n[45]=[i.AND,i.absoluteMode,0];n[61]=[i.AND,i.absoluteXMode,0];n[57]=[i.AND,i.absoluteYMode,0];n[33]=[i.AND,i.indirectXMode,0];n[49]=[i.AND,i.indirectYMode,0];n[9]=[i.ORA,i.immediateMode,0];n[5]=[i.ORA,i.zeroPageMode,0];n[21]=[i.ORA,i.zeroPageXMode,0];n[13]=[i.ORA,i.absoluteMode,0];n[29]=[i.ORA,i.absoluteXMode,0];n[25]=[i.ORA,i.absoluteYMode,
0];n[1]=[i.ORA,i.indirectXMode,0];n[17]=[i.ORA,i.indirectYMode,0];n[73]=[i.EOR,i.immediateMode,0];n[69]=[i.EOR,i.zeroPageMode,0];n[85]=[i.EOR,i.zeroPageXMode,0];n[77]=[i.EOR,i.absoluteMode,0];n[93]=[i.EOR,i.absoluteXMode,0];n[89]=[i.EOR,i.absoluteYMode,0];n[65]=[i.EOR,i.indirectXMode,0];n[81]=[i.EOR,i.indirectYMode,0];n[36]=[i.BIT,i.zeroPageMode,0];n[44]=[i.BIT,i.absoluteMode,0];n[230]=[i.INC,i.zeroPageMode,0];n[246]=[i.INC,i.zeroPageXMode,0];n[238]=[i.INC,i.absoluteMode,0];n[254]=[i.INC,i.absoluteXMode,
v];n[232]=[i.INX,i.impliedMode,0];n[200]=[i.INY,i.impliedMode,0];n[198]=[i.DEC,i.zeroPageMode,0];n[214]=[i.DEC,i.zeroPageXMode,0];n[206]=[i.DEC,i.absoluteMode,0];n[222]=[i.DEC,i.absoluteXMode,v];n[202]=[i.DEX,i.impliedMode,0];n[136]=[i.DEY,i.impliedMode,0];n[201]=[i.CMP,i.immediateMode,0];n[197]=[i.CMP,i.zeroPageMode,0];n[213]=[i.CMP,i.zeroPageXMode,0];n[205]=[i.CMP,i.absoluteMode,0];n[221]=[i.CMP,i.absoluteXMode,0];n[217]=[i.CMP,i.absoluteYMode,0];n[193]=[i.CMP,i.indirectXMode,0];n[209]=[i.CMP,
i.indirectYMode,0];n[224]=[i.CPX,i.immediateMode,0];n[228]=[i.CPX,i.zeroPageMode,0];n[236]=[i.CPX,i.absoluteMode,0];n[192]=[i.CPY,i.immediateMode,0];n[196]=[i.CPY,i.zeroPageMode,0];n[204]=[i.CPY,i.absoluteMode,0];n[144]=[i.BCC,i.relativeMode,0];n[176]=[i.BCS,i.relativeMode,0];n[208]=[i.BNE,i.relativeMode,0];n[240]=[i.BEQ,i.relativeMode,0];n[80]=[i.BVC,i.relativeMode,0];n[112]=[i.BVS,i.relativeMode,0];n[16]=[i.BPL,i.relativeMode,0];n[48]=[i.BMI,i.relativeMode,0];n[76]=[i.JMP,i.absoluteMode,0];n[108]=
[i.JMP,i.indirectMode,0];n[32]=[i.JSR,i.absoluteMode,0];n[96]=[i.RTS,i.impliedMode,0];n[0]=[i.BRK,i.impliedMode,0];n[64]=[i.RTI,i.impliedMode,0];n[105]=[i.ADC,i.immediateMode,0];n[101]=[i.ADC,i.zeroPageMode,0];n[117]=[i.ADC,i.zeroPageXMode,0];n[109]=[i.ADC,i.absoluteMode,0];n[125]=[i.ADC,i.absoluteXMode,0];n[121]=[i.ADC,i.absoluteYMode,0];n[97]=[i.ADC,i.indirectXMode,0];n[113]=[i.ADC,i.indirectYMode,0];n[233]=[i.SBC,i.immediateMode,0];n[235]=[i.SBC,i.immediateMode,0];n[229]=[i.SBC,i.zeroPageMode,
0];n[245]=[i.SBC,i.zeroPageXMode,0];n[237]=[i.SBC,i.absoluteMode,0];n[253]=[i.SBC,i.absoluteXMode,0];n[249]=[i.SBC,i.absoluteYMode,0];n[225]=[i.SBC,i.indirectXMode,0];n[241]=[i.SBC,i.indirectYMode,0];n[10]=[i.ASL,i.accumulatorMode,0];n[6]=[i.ASL,i.zeroPageMode,0];n[22]=[i.ASL,i.zeroPageXMode,0];n[14]=[i.ASL,i.absoluteMode,0];n[30]=[i.ASL,i.absoluteXMode,v];n[74]=[i.LSR,i.accumulatorMode,0];n[70]=[i.LSR,i.zeroPageMode,0];n[86]=[i.LSR,i.zeroPageXMode,0];n[78]=[i.LSR,i.absoluteMode,0];n[94]=[i.LSR,
i.absoluteXMode,v];n[42]=[i.ROL,i.accumulatorMode,0];n[38]=[i.ROL,i.zeroPageMode,0];n[54]=[i.ROL,i.zeroPageXMode,0];n[46]=[i.ROL,i.absoluteMode,0];n[62]=[i.ROL,i.absoluteXMode,v];n[106]=[i.ROR,i.accumulatorMode,0];n[102]=[i.ROR,i.zeroPageMode,0];n[118]=[i.ROR,i.zeroPageXMode,0];n[110]=[i.ROR,i.absoluteMode,0];n[126]=[i.ROR,i.absoluteXMode,v];n[199]=[i.DCP,i.zeroPageMode,0];n[215]=[i.DCP,i.zeroPageXMode,0];n[207]=[i.DCP,i.absoluteMode,0];n[223]=[i.DCP,i.absoluteXMode,v];n[219]=[i.DCP,i.absoluteYMode,
v];n[195]=[i.DCP,i.indirectXMode,0];n[211]=[i.DCP,i.indirectYMode,v];n[231]=[i.ISB,i.zeroPageMode,0];n[247]=[i.ISB,i.zeroPageXMode,0];n[239]=[i.ISB,i.absoluteMode,0];n[255]=[i.ISB,i.absoluteXMode,v];n[251]=[i.ISB,i.absoluteYMode,v];n[227]=[i.ISB,i.indirectXMode,0];n[243]=[i.ISB,i.indirectYMode,v];n[7]=[i.SLO,i.zeroPageMode,0];n[23]=[i.SLO,i.zeroPageXMode,0];n[15]=[i.SLO,i.absoluteMode,0];n[31]=[i.SLO,i.absoluteXMode,v];n[27]=[i.SLO,i.absoluteYMode,v];n[3]=[i.SLO,i.indirectXMode,0];n[19]=[i.SLO,i.
indirectYMode,v];n[71]=[i.SRE,i.zeroPageMode,0];n[87]=[i.SRE,i.zeroPageXMode,0];n[79]=[i.SRE,i.absoluteMode,0];n[95]=[i.SRE,i.absoluteXMode,v];n[91]=[i.SRE,i.absoluteYMode,v];n[67]=[i.SRE,i.indirectXMode,0];n[83]=[i.SRE,i.indirectYMode,v];n[39]=[i.RLA,i.zeroPageMode,0];n[55]=[i.RLA,i.zeroPageXMode,0];n[47]=[i.RLA,i.absoluteMode,0];n[63]=[i.RLA,i.absoluteXMode,v];n[59]=[i.RLA,i.absoluteYMode,v];n[35]=[i.RLA,i.indirectXMode,0];n[51]=[i.RLA,i.indirectYMode,v];n[139]=[i.XAA,i.immediateMode,0];n[103]=
[i.RRA,i.zeroPageMode,0];n[119]=[i.RRA,i.zeroPageXMode,0];n[111]=[i.RRA,i.absoluteMode,0];n[127]=[i.RRA,i.absoluteXMode,v];n[123]=[i.RRA,i.absoluteYMode,v];n[99]=[i.RRA,i.indirectXMode,0];n[115]=[i.RRA,i.indirectYMode,v];n[203]=[i.AXS,i.immediateMode,0];n[11]=[i.ANC,i.immediateMode,0];n[43]=[i.ANC,i.immediateMode,0];n[75]=[i.ALR,i.immediateMode,0];n[107]=[i.ARR,i.immediateMode,0];n[155]=[i.TAS,i.absoluteYMode,v]});var Oe=c(function(X){"use strict";var vn=X&&X.__createBinding||(Object.create?function(e,t,r,o){if(o===void 0)o=r;var s=Object.getOwnPropertyDescriptor(t,r);if(!s||("get"in s?!t.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,o,s)}:function(e,t,r,o){if(o===void 0)o=r;e[o]=t[r]});var _n=X&&X.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var Cn=X&&
X.__importStar||function(){var e=function(t){e=Object.getOwnPropertyNames||function(r){var o=[];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s))o[o.length]=s;return o};return e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(t!=null){for(var o=e(t),s=0;s<o.length;s++)if(o[s]!=="default")vn(r,t,o[s])}_n(r,t);return r}}();var xn=X&&X.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(X,"__esModule",{value:true});X.Interrupt=X.CPU=void 0;
var On=Cn(dt());X.Interrupt=On;var Fn=Hr();Object.defineProperty(X,"CPU",{enumerable:true,get:function(){return xn(Fn).default}})});var Kt=c(function(Qt){"use strict";Object.defineProperty(Qt,"__esModule",{value:true});Qt.LENGTH_COUNTER_VALUES=void 0;Qt.LENGTH_COUNTER_VALUES=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]});var qr=c(function(Fe){"use strict";Object.defineProperty(Fe,"__esModule",{value:true});var zr=B();var Sn=Kt();var bn=[[0,1,0,0,0,0,0,0],[0,1,1,0,0,0,0,0],[0,1,1,1,1,0,0,0],[1,0,0,1,1,1,1,1]];var Bn=function(){function e(t){zr.log.info("Initializing pulse channel #".concat(t));this.id=t;this.enabled=false;this.gain=1;this.timerCycle=0;this.timerPeriod=0;this.lengthCounter=0;this.lengthCounterHalt=false;this.useConstantVolume=false;this.constantVolume=0;this.envelopeReset=false;this.envelopeCycle=
0;this.envelopeVolume=0;this.envelopeLoop=false;this.envelopePeriod=0;this.sweepEnabled=false;this.sweepCycle=0;this.sweepReset=false;this.sweepNegate=false;this.sweepPeriod=0;this.sweepShift=0;this.dutyPosition=0;this.dutySelection=0}e.prototype.reset=function(){zr.log.info("Resetting pulse channel #".concat(this.id));this.timerCycle=0;this.timerPeriod=0;this.envelopeCycle=0;this.envelopeVolume=0;this.sweepCycle=0;this.setEnabled(false);this.writeDutyEnvelope(0);this.writeSweep(0);this.writeTimer(
0);this.writeLengthCounter(0)};e.prototype.setEnabled=function(t){if(!t){this.lengthCounter=0}this.enabled=t};e.prototype.writeDutyEnvelope=function(t){this.dutySelection=(t&192)>>>6;this.lengthCounterHalt=(t&32)!==0;this.useConstantVolume=(t&16)!==0;this.constantVolume=t&15;this.envelopeLoop=this.lengthCounterHalt;this.envelopePeriod=this.constantVolume};e.prototype.writeSweep=function(t){this.sweepEnabled=(t&128)!==0;this.sweepPeriod=(t&112)>>>4;this.sweepNegate=(t&8)!==0;this.sweepShift=t&7;this.
sweepReset=true};e.prototype.writeTimer=function(t){this.timerPeriod=this.timerPeriod&1792|t&255};e.prototype.writeLengthCounter=function(t){if(this.enabled){this.lengthCounter=Sn.LENGTH_COUNTER_VALUES[(t&248)>>>3]}this.timerPeriod=this.timerPeriod&255|(t&7)<<8;this.dutyPosition=0;this.envelopeReset=true};e.prototype.tick=function(){if(--this.timerCycle<=0){this.timerCycle=this.timerPeriod+1<<1;this.dutyPosition=this.dutyPosition+1&7}};e.prototype.tickQuarterFrame=function(){this.updateEnvelope()};
e.prototype.tickHalfFrame=function(){this.updateLengthCounter();this.updateSweep()};e.prototype.updateEnvelope=function(){if(this.envelopeReset){this.envelopeReset=false;this.envelopeCycle=this.envelopePeriod;this.envelopeVolume=15}else if(this.envelopeCycle>0){this.envelopeCycle--}else{this.envelopeCycle=this.envelopePeriod;if(this.envelopeVolume>0){this.envelopeVolume--}else if(this.envelopeLoop){this.envelopeVolume=15}}};e.prototype.updateLengthCounter=function(){if(this.lengthCounter>0&&!this.
lengthCounterHalt){this.lengthCounter--}};e.prototype.updateSweep=function(){if(this.sweepCycle>0){this.sweepCycle--}else{if(this.sweepEnabled&&this.sweepShift&&this.isTimerPeriodValid()){this.timerPeriod+=this.getSweep()}this.sweepCycle=this.sweepPeriod}if(this.sweepReset){this.sweepReset=false;this.sweepCycle=this.sweepPeriod}};e.prototype.getSweep=function(){var t=this.timerPeriod>>>this.sweepShift;if(this.sweepNegate){return this.id===1?~t:-t}return t};e.prototype.isTimerPeriodValid=function(){
return this.timerPeriod>=8&&this.timerPeriod+this.getSweep()<2048};e.prototype.getOutput=function(){if(this.lengthCounter&&this.isTimerPeriodValid()){var t=this.useConstantVolume?this.constantVolume:this.envelopeVolume;return this.gain*t*bn[this.dutySelection][this.dutyPosition]}return 0};return e}();Fe.default=Bn});var jr=c(function(Se){"use strict";Object.defineProperty(Se,"__esModule",{value:true});var Xr=B();var wn=Kt();var En=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];var Dn=function(){function e(){Xr.log.info("Initializing triangle channel");this.enabled=false;this.gain=1;this.timerCycle=0;this.timerPeriod=0;this.lengthCounter=0;this.lengthCounterHalt=false;this.linearCounter=0;this.linearCounterMax=0;this.linearCounterControl=false;this.linearCounterReset=false;this.
dutyPosition=15}e.prototype.reset=function(){Xr.log.info("Resetting triangle channel");this.timerCycle=0;this.timerPeriod=0;this.dutyPosition=0;this.linearCounter=0;this.setEnabled(false);this.writeLinearCounter(0);this.writeTimer(0);this.writeLengthCounter(0)};e.prototype.setEnabled=function(t){if(!t){this.lengthCounter=0}this.enabled=t};e.prototype.writeLinearCounter=function(t){this.lengthCounterHalt=(t&128)!==0;this.linearCounterMax=t&127;this.linearCounterControl=this.lengthCounterHalt};e.prototype.
writeTimer=function(t){this.timerPeriod=this.timerPeriod&1792|t&255};e.prototype.writeLengthCounter=function(t){if(this.enabled){this.lengthCounter=wn.LENGTH_COUNTER_VALUES[(t&248)>>>3]}this.timerPeriod=this.timerPeriod&255|(t&7)<<8;this.linearCounterReset=true};e.prototype.tick=function(){if(--this.timerCycle<=0){this.timerCycle=this.timerPeriod+1;if(this.lengthCounter&&this.linearCounter&&this.timerPeriod>3){this.dutyPosition=this.dutyPosition+1&31}}};e.prototype.tickQuarterFrame=function(){this.
updateLinearCounter()};e.prototype.tickHalfFrame=function(){this.updateLengthCounter()};e.prototype.updateLinearCounter=function(){if(this.linearCounterReset){this.linearCounter=this.linearCounterMax}else if(this.linearCounter>0){this.linearCounter--}if(!this.linearCounterControl){this.linearCounterReset=false}};e.prototype.updateLengthCounter=function(){if(this.lengthCounter>0&&!this.lengthCounterHalt){this.lengthCounter--}};e.prototype.getOutput=function(){return this.gain*En[this.dutyPosition]};
return e}();Se.default=Dn});var Ur=c(function(be){"use strict";Object.defineProperty(be,"__esModule",{value:true});var Vr=B();var In=Kt();var kn=function(){function e(){Vr.log.info("Initializing noise channel");this.enabled=false;this.gain=1;this.timerMode=false;this.timerCycle=0;this.timerPeriod=0;this.timerPeriods=null;this.lengthCounter=0;this.lengthCounterHalt=false;this.useConstantVolume=false;this.constantVolume=0;this.envelopeReset=false;this.envelopeCycle=0;this.envelopeVolume=0;this.envelopeLoop=false;this.envelopePeriod=
0;this.shiftRegister=0}e.prototype.reset=function(){Vr.log.info("Resetting noise channel");this.timerCycle=0;this.envelopeCycle=0;this.envelopeVolume=0;this.shiftRegister=1;this.setEnabled(false);this.writeEnvelope(0);this.writeTimer(0);this.writeLengthCounter(0)};e.prototype.setEnabled=function(t){if(!t){this.lengthCounter=0}this.enabled=t};e.prototype.setRegionParams=function(t){this.timerPeriods=t.noiseChannelTimerPeriods};e.prototype.writeEnvelope=function(t){this.lengthCounterHalt=(t&32)!==
0;this.useConstantVolume=(t&16)!==0;this.constantVolume=t&15;this.envelopeLoop=this.lengthCounterHalt;this.envelopePeriod=this.constantVolume};e.prototype.writeTimer=function(t){this.timerMode=(t&128)!==0;this.timerPeriod=this.timerPeriods[t&15]};e.prototype.writeLengthCounter=function(t){if(this.enabled){this.lengthCounter=In.LENGTH_COUNTER_VALUES[(t&248)>>>3]}this.envelopeReset=true};e.prototype.tick=function(){if(--this.timerCycle<=0){this.timerCycle=this.timerPeriod;this.updateShiftRegister()}};
e.prototype.tickQuarterFrame=function(){this.updateEnvelope()};e.prototype.tickHalfFrame=function(){this.updateLengthCounter()};e.prototype.updateShiftRegister=function(){var t=this.timerMode?6:1;var r=this.shiftRegister&1^this.shiftRegister>>>t&1;this.shiftRegister=this.shiftRegister>>>1|r<<14};e.prototype.updateEnvelope=function(){if(this.envelopeReset){this.envelopeReset=false;this.envelopeCycle=this.envelopePeriod;this.envelopeVolume=15}else if(this.envelopeCycle>0){this.envelopeCycle--}else{
this.envelopeCycle=this.envelopePeriod;if(this.envelopeVolume>0){this.envelopeVolume--}else if(this.envelopeLoop){this.envelopeVolume=15}}};e.prototype.updateLengthCounter=function(){if(this.lengthCounter>0&&!this.lengthCounterHalt){this.lengthCounter--}};e.prototype.getOutput=function(){if(this.lengthCounter&&!(this.shiftRegister&1)){var t=this.useConstantVolume?this.constantVolume:this.envelopeVolume;return this.gain*t}return 0};return e}();be.default=kn});var Yr=c(function(we){"use strict";Object.defineProperty(we,"__esModule",{value:true});var Be=B();var Gr=dt();var Ln=function(){function e(){Be.log.info("Initializing DMC channel");this.enabled=false;this.output=0;this.gain=1;this.timerCycle=0;this.timerPeriod=0;this.timerPeriods=null;this.sampleAddress=0;this.sampleLength=0;this.sampleCurrentAddress=0;this.sampleRemainingLength=0;this.sampleLoop=false;this.sampleBuffer=-1;this.shiftRegister=-1;this.shiftRegisterBits=0;this.memoryAccessCycles=0;
this.irqEnabled=false;this.irqActive=false;this.cpu=null;this.cpuMemory=null}e.prototype.connect=function(t){Be.log.info("Connecting DMC channel");this.cpu=t.cpu;this.cpuMemory=t.cpuMemory};e.prototype.reset=function(){Be.log.info("Resetting DMC channel");this.timerCycle=0;this.sampleBuffer=-1;this.shiftRegister=-1;this.shiftRegisterBits=0;this.memoryAccessCycles=0;this.setEnabled(false);this.writeFlagsTimer(0);this.writeOutputLevel(0);this.writeSampleAddress(0);this.writeSampleLength(0)};e.prototype.
setEnabled=function(t){if(!t){this.sampleRemainingLength=0}else if(this.sampleRemainingLength===0){this.sampleCurrentAddress=this.sampleAddress;this.sampleRemainingLength=this.sampleLength}this.enabled=t;this.clearIRQ()};e.prototype.setRegionParams=function(t){this.timerPeriods=t.dmcChannelTimerPeriods};e.prototype.activateIRQ=function(){this.irqActive=true;this.cpu.activateInterrupt(Gr.IRQ_DMC)};e.prototype.clearIRQ=function(){this.irqActive=false;this.cpu.clearInterrupt(Gr.IRQ_DMC)};e.prototype.
writeFlagsTimer=function(t){this.irqEnabled=(t&128)!==0;this.sampleLoop=(t&64)!==0;this.timerPeriod=this.timerPeriods[t&15];if(!this.irqEnabled){this.clearIRQ()}};e.prototype.writeOutputLevel=function(t){this.output=t&127};e.prototype.writeSampleAddress=function(t){this.sampleAddress=49152|(t&255)<<6};e.prototype.writeSampleLength=function(t){this.sampleLength=(t&255)<<4|1};e.prototype.tick=function(){if(this.memoryAccessCycles>0){this.memoryAccessCycles--}if(--this.timerCycle<=0){this.timerCycle=
this.timerPeriod;this.updateSample()}};e.prototype.updateSample=function(){this.updateSampleBuffer();this.updateShiftRegister();this.updateOutput()};e.prototype.updateSampleBuffer=function(){if(this.sampleBuffer<0&&this.sampleRemainingLength>0){this.sampleBuffer=this.cpuMemory.read(this.sampleCurrentAddress);this.memoryAccessCycles=4;if(this.sampleCurrentAddress<65535){this.sampleCurrentAddress++}else{this.sampleCurrentAddress=32768}if(--this.sampleRemainingLength<=0){if(this.sampleLoop){this.sampleCurrentAddress=
this.sampleAddress;this.sampleRemainingLength=this.sampleLength}else if(this.irqEnabled){this.activateIRQ()}}}};e.prototype.updateShiftRegister=function(){if(--this.shiftRegisterBits<=0){this.shiftRegisterBits=8;this.shiftRegister=this.sampleBuffer;this.sampleBuffer=-1}};e.prototype.updateOutput=function(){if(this.shiftRegister>=0){if(this.shiftRegister&1){if(this.output<=125){this.output+=2}}else if(this.output>=2){this.output-=2}this.shiftRegister>>>=1}};e.prototype.getOutput=function(){return this.
gain*this.output};return e}();we.default=Ln});var Qr=c(function(V){"use strict";var Wt=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(V,"__esModule",{value:true});V.DMC=V.Noise=V.Triangle=V.Pulse=void 0;var Tn=qr();Object.defineProperty(V,"Pulse",{enumerable:true,get:function(){return Wt(Tn).default}});var Nn=jr();Object.defineProperty(V,"Triangle",{enumerable:true,get:function(){return Wt(Nn).default}});var Hn=Ur();Object.defineProperty(V,"Noise",{enumerable:true,get:function(){return Wt(Hn).
default}});var zn=Yr();Object.defineProperty(V,"DMC",{enumerable:true,get:function(){return Wt(zn).default}})});var Wr=c(function(Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:true});var xt=B();var Kr=dt();var Lt=Qr();var qn=29829.55;var Xn=function(){function e(){xt.log.info("Initializing APU");this.pulse1=new Lt.Pulse(1);this.pulse2=new Lt.Pulse(2);this.triangle=new Lt.Triangle;this.noise=new Lt.Noise;this.dmc=new Lt.DMC;this.channels=[this.pulse1,this.pulse2,this.triangle,this.noise,this.dmc];this.frameCounter=-1;this.frameCounterMax4=null;this.frameCounterMax5=null;this.frameCounterResetDelay=
0;this.frameCounterLast=0;this.frameFiveStepMode=false;this.frameStep=0;this.frameIrqActive=false;this.frameIrqDisabled=false;this.sampleRate=0;this.ticksToOutput=0;this.ticksPerSecond=0;this.callback=null;this.cpu=null}e.prototype.connect=function(t){xt.log.info("Connecting APU");this.cpu=t.cpu;this.dmc.connect(t)};e.prototype.reset=function(){xt.log.info("Resetting APU");this.pulse1.reset();this.pulse2.reset();this.triangle.reset();this.noise.reset();this.dmc.reset();this.clearFrameIRQ();this.
writeFrameCounter(0)};e.prototype.setRegionParams=function(t){xt.log.info("Setting APU region parameters");this.frameCounterMax4=t.frameCounterMax4;this.frameCounterMax5=t.frameCounterMax5;this.ticksPerSecond=qn*t.framesPerSecond;this.noise.setRegionParams(t);this.dmc.setRegionParams(t)};e.prototype.setSampleRate=function(t){this.sampleRate=t};e.prototype.getSampleRate=function(){return this.sampleRate};e.prototype.setCallback=function(t){xt.log.info((t?"Setting":"Removing")+" APU callback");this.
callback=t};e.prototype.getCallback=function(){return this.callback};e.prototype.setVolume=function(t,r){xt.log.info("Setting volume of APU channel #".concat(t," to ").concat(r));this.channels[t].gain=r};e.prototype.getVolume=function(t){return this.channels[t].gain};e.prototype.writeFrameCounter=function(t){this.frameCounterLast=t;this.frameFiveStepMode=(t&128)!==0;this.frameIrqDisabled=(t&64)!==0;this.frameCounterResetDelay=4;this.frameStep=0;if(this.frameCounter<0){this.frameCounter=this.getFrameCounterMax()}
if(this.frameIrqDisabled){this.clearFrameIRQ()}if(this.frameFiveStepMode){this.tickHalfFrame();this.tickQuarterFrame()}};e.prototype.getFrameCounterMax=function(){var t=this.frameFiveStepMode?this.frameCounterMax5:this.frameCounterMax4;return t[this.frameStep]};e.prototype.activateFrameIRQ=function(){this.frameIrqActive=true;this.cpu.activateInterrupt(Kr.IRQ_APU)};e.prototype.clearFrameIRQ=function(){this.frameIrqActive=false;this.cpu.clearInterrupt(Kr.IRQ_APU)};e.prototype.writePulseDutyEnvelope=
function(t,r){this.getPulse(t).writeDutyEnvelope(r)};e.prototype.writePulseSweep=function(t,r){this.getPulse(t).writeSweep(r)};e.prototype.writePulseTimer=function(t,r){this.getPulse(t).writeTimer(r)};e.prototype.writePulseLengthCounter=function(t,r){this.getPulse(t).writeLengthCounter(r)};e.prototype.getPulse=function(t){return t===1?this.pulse1:this.pulse2};e.prototype.writeTriangleLinearCounter=function(t){this.triangle.writeLinearCounter(t)};e.prototype.writeTriangleTimer=function(t){this.triangle.
writeTimer(t)};e.prototype.writeTriangleLengthCounter=function(t){this.triangle.writeLengthCounter(t)};e.prototype.writeNoiseEnvelope=function(t){this.noise.writeEnvelope(t)};e.prototype.writeNoiseTimer=function(t){this.noise.writeTimer(t)};e.prototype.writeNoiseLengthCounter=function(t){this.noise.writeLengthCounter(t)};e.prototype.writeDMCFlagsTimer=function(t){this.dmc.writeFlagsTimer(t)};e.prototype.writeDMCOutputLevel=function(t){this.dmc.writeOutputLevel(t)};e.prototype.writeDMCSampleAddress=
function(t){this.dmc.writeSampleAddress(t)};e.prototype.writeDMCSampleLength=function(t){this.dmc.writeSampleLength(t)};e.prototype.writeStatus=function(t){this.pulse1.setEnabled((t&1)!==0);this.pulse2.setEnabled((t&2)!==0);this.triangle.setEnabled((t&4)!==0);this.noise.setEnabled((t&8)!==0);this.dmc.setEnabled((t&16)!==0)};e.prototype.readStatus=function(){var t=this.getStatus();this.clearFrameIRQ();return t};e.prototype.getStatus=function(){return this.pulse1.lengthCounter>0|(this.pulse2.lengthCounter>
0)<<1|(this.triangle.lengthCounter>0)<<2|(this.noise.lengthCounter>0)<<3|(this.dmc.sampleRemainingLength>0)<<4|this.frameIrqActive<<6|this.dmc.irqActive<<7};e.prototype.isBlockingCPU=function(){return this.dmc.memoryAccessCycles>0};e.prototype.isBlockingDMA=function(){return this.dmc.memoryAccessCycles>2};e.prototype.tick=function(){this.tickFrameCounter();this.pulse1.tick();this.pulse2.tick();this.triangle.tick();this.noise.tick();this.dmc.tick();this.tickOutput()};e.prototype.tickFrameCounter=
function(){if(this.frameCounterResetDelay&&--this.frameCounterResetDelay<=0){this.frameCounter=this.getFrameCounterMax()}if(--this.frameCounter<=0){this.tickFrameStep()}};e.prototype.tickFrameStep=function(){this.frameStep=(this.frameStep+1)%6;this.frameCounter=this.getFrameCounterMax();switch(this.frameStep){case 1:this.tickQuarterFrame();break;case 2:this.tickQuarterFrame();this.tickHalfFrame();break;case 3:this.tickQuarterFrame();break;case 4:this.tickFrameIRQ();break;case 5:this.tickQuarterFrame();
this.tickHalfFrame();this.tickFrameIRQ();break;case 0:this.tickFrameIRQ();break}};e.prototype.tickQuarterFrame=function(){this.pulse1.tickQuarterFrame();this.pulse2.tickQuarterFrame();this.triangle.tickQuarterFrame();this.noise.tickQuarterFrame()};e.prototype.tickHalfFrame=function(){this.pulse1.tickHalfFrame();this.pulse2.tickHalfFrame();this.triangle.tickHalfFrame();this.noise.tickHalfFrame()};e.prototype.tickFrameIRQ=function(){if(!this.frameIrqDisabled&&!this.frameFiveStepMode){this.activateFrameIRQ()}};
e.prototype.tickOutput=function(){if(this.callback&&--this.ticksToOutput<=0){this.ticksToOutput+=this.ticksPerSecond/this.sampleRate;this.callback(this.getOutput())}};e.prototype.getOutput=function(){var t=0;var r=this.pulse1.getOutput();var o=this.pulse2.getOutput();if(r||o){t+=95.88/(8128/(r+o)+100)}var s=this.triangle.getOutput();var a=this.noise.getOutput();var P=this.dmc.getOutput();if(s||a||P){t+=159.79/(1/(s/8227+a/12241+P/22638)+100)}return t};return e}();Ee.default=Xn});var De=c(function(Ot){"use strict";var jn=Ot&&Ot.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(Ot,"__esModule",{value:true});Ot.APU=void 0;var Vn=Wr();Object.defineProperty(Ot,"APU",{enumerable:true,get:function(){return jn(Vn).default}})});var Jr=c(function(ke){"use strict";Object.defineProperty(ke,"__esModule",{value:true});var Mt=B();var Zt=gr();var Ie=Gt();var Zr=Oe();var Un=De();var Gn=function(){function e(t){if(t===void 0){t={}}Mt.log.info("Initializing NES");this.cpu=t.cpu||new Zr.CPU;this.ppu=t.ppu||new Ie.PPU;this.apu=t.apu||new Un.APU;this.dma=t.dma||new Zt.DMA;this.cpuMemory=t.cpuMemory||new Zt.CPUMemory;this.ppuMemory=t.ppuMemory||new Zt.PPUMemory;this.cartridge=null;this.mapper=null;this.region=null;this.connectUnits();
this.applyRegion()}e.prototype.connectUnits=function(){this.cpu.connect(this);this.ppu.connect(this);this.apu.connect(this);this.dma.connect(this);this.cpuMemory.connect(this)};e.prototype.resetUnits=function(){this.cpuMemory.reset();this.ppuMemory.reset();this.mapper.reset();this.ppu.reset();this.apu.reset();this.dma.reset();this.cpu.reset()};e.prototype.setRegion=function(t){this.region=t;this.applyRegion()};e.prototype.getRegion=function(){return this.region};e.prototype.getUsedRegion=function(){
return this.region||this.cartridge&&this.cartridge.region||Mt.Region.NTSC};e.prototype.applyRegion=function(){Mt.log.info("Updating region parameters");var t=this.getUsedRegion();var r=Mt.Region.getParams(t);Mt.log.info('Detected region: "'.concat(t,'"'));this.ppu.setRegionParams(r);this.apu.setRegionParams(r)};e.prototype.setCartridge=function(t){if(this.cartridge){Mt.log.info("Removing current cartridge");if(this.mapper){this.mapper.disconnect();this.mapper=null}this.cartridge=null}if(t){Mt.log.
info("Inserting cartridge");this.cartridge=t;this.mapper=(0,Zt.createMapper)(t);this.mapper.connect(this);this.applyRegion();this.power()}};e.prototype.getCartridge=function(){return this.cartridge};e.prototype.power=function(){if(this.cartridge){this.resetUnits()}};e.prototype.reset=function(){this.cpu.activateInterrupt(Zr.Interrupt.RESET)};e.prototype.setInputDevice=function(t,r){var o=this.cpuMemory.getInputDevice(t);if(o){o.disconnect()}this.cpuMemory.setInputDevice(t,r);if(r){r.connect(this)}};
e.prototype.getInputDevice=function(t){return this.cpuMemory.getInputDevice(t)};e.prototype.setPalette=function(t){this.ppu.setBasePalette(t)};e.prototype.getPalette=function(){return this.ppu.getBasePalette()};e.prototype.renderFrame=function(t){if(this.cartridge){this.ppu.setFrameBuffer(t);while(!this.ppu.isFrameAvailable()){this.cpu.step()}}else{this.renderWhiteNoise(t)}};e.prototype.renderDebugFrame=function(t){if(this.cartridge){this.ppu.setFrameBuffer(t);this.ppu.renderDebugFrame()}else{this.
renderEmptyFrame(t)}};e.prototype.renderWhiteNoise=function(t){for(var r=0;r<135;r++){for(var o=0;o<240;o++){var s=~~(255*Math.random());t.drawPixel(o,r,(0,Ie.packColor)(s,s,s))}}};e.prototype.renderEmptyFrame=function(t){t.fill(Ie.BLACK_COLOR)};e.prototype.setAudioSampleRate=function(t){this.apu.setSampleRate(t)};e.prototype.getAudioSampleRate=function(){return this.apu.getSampleRate()};e.prototype.setAudioCallback=function(t){this.apu.setCallback(t)};e.prototype.getAudioCallback=function(){return this.
apu.getCallback()};e.prototype.setAudioVolume=function(t,r){this.apu.setVolume(t,r)};e.prototype.getAudioVolume=function(t){return this.apu.getVolume(t)};e.prototype.getNVRAM=function(){return this.mapper?this.mapper.getNVRAM():null};return e}();ke.default=Gn});var ti=c(function(Tt){"use strict";Object.defineProperty(Tt,"__esModule",{value:true});Tt.Button=void 0;var $r=B();Tt.Button={A:0,B:1,SELECT:2,START:3,UP:4,DOWN:5,LEFT:6,RIGHT:7};var Yn=function(){function e(){this.buttonStates=new Uint8Array(24);this.buttonStates[19]=1;this.readPosition=0}e.prototype.connect=function(){$r.log.info("Connecting joypad")};e.prototype.disconnect=function(){$r.log.info("Disconnecting joypad")};e.prototype.strobe=function(){this.readPosition=0};e.prototype.read=function(){
var t=this.buttonStates[this.readPosition];this.readPosition=(this.readPosition+1)%this.buttonStates.length;return t};e.prototype.setButtonPressed=function(t,r){this.buttonStates[t]=r?1:0};e.prototype.isButtonPressed=function(t){return this.buttonStates[t]===1};return e}();Tt.default=Yn});var ii=c(function(Le){"use strict";Object.defineProperty(Le,"__esModule",{value:true});var ei=B();var ri=Gt();var Qn=function(){function e(){this.triggerPressed=false;this.beamX=-1;this.beamY=-1;this.ppu=null}e.prototype.connect=function(t){ei.log.info("Connecting zapper");this.ppu=t.ppu};e.prototype.disconnect=function(){ei.log.info("Disconnecting zapper");this.ppu=null};e.prototype.strobe=function(){};e.prototype.read=function(){return this.triggerPressed<<4|!this.isLightDetected()<<3};e.prototype.
isLightDetected=function(){return this.beamX>=0&&this.beamX<ri.VIDEO_WIDTH&&this.beamY>=0&&this.beamY<ri.VIDEO_HEIGHT&&this.ppu.isBrightFramePixel(this.beamX,this.beamY)};e.prototype.setTriggerPressed=function(t){this.triggerPressed=t};e.prototype.isTriggerPressed=function(){return this.triggerPressed};e.prototype.setBeamPosition=function(t,r){this.beamX=t;this.beamY=r};e.prototype.getBeamPosition=function(){return[this.beamX,this.beamY]};return e}();Le.default=Qn});var si=c(function(J){"use strict";var oi=J&&J.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(J,"__esModule",{value:true});J.Zapper=J.Button=J.Joypad=void 0;var ni=ti();Object.defineProperty(J,"Joypad",{enumerable:true,get:function(){return oi(ni).default}});Object.defineProperty(J,"Button",{enumerable:true,get:function(){return ni.Button}});var Kn=ii();Object.defineProperty(J,"Zapper",{enumerable:true,get:function(){return oi(Kn).default}})});var ui=c(function(Ft){"use strict";var Nt;Object.defineProperty(Ft,"__esModule",{value:true});Ft.name=void 0;Ft.supports=ai;Ft.parse=Jn;var O=B();Ft.name="iNES / NES 2.0";var Wn={0:O.Mapper.NROM,1:O.Mapper.MMC1,2:O.Mapper.UNROM,3:O.Mapper.CNROM,4:O.Mapper.MMC3,7:O.Mapper.AOROM,11:O.Mapper.COLOR_DREAMS,34:O.Mapper.BNROM};var Zn=(Nt={},Nt[$t(1,1)]=O.Submapper.SUROM,Nt[$t(1,2)]=O.Submapper.SOROM,Nt[$t(1,3)]=O.Submapper.SXROM,Nt);function $t(e,t){return e<<4|t}function ai(e){return e[0]===78&&e[1]===
69&&e[2]===83&&e[3]===26}function Jn(e){if(!ai(e)){throw new Error("Incorrect signature")}if(e.length<16){throw new Error("Input is too short: expected at least 16 B but got "+(0,O.formatSize)(e.length))}var t;var r=e[4];var o=e[5];var s,a;var P=e[7]&240|e[6]>>>4;var S;var h,l;var b,M;if(e[6]&8){a=O.Mirroring.FOUR_SCREEN}else if(e[6]&1){a=O.Mirroring.VERTICAL}else{a=O.Mirroring.HORIZONTAL}if((e[7]&12)===8){O.log.info("Detected NES 2.0 format");t=2;P|=(e[8]&15)<<8;S=(e[8]&240)>>>4;r|=(e[9]&15)<<8;
o|=(e[9]&240)<<4;l=Jt((e[10]&240)>>>4);M=Jt((e[11]&240)>>>4);h=l+Jt(e[10]&15);b=M+Jt(e[11]&15);s=e[12]&1?O.Region.PAL:O.Region.NTSC}else{O.log.info("Detected iNES format");t=1;h=(e[8]||1)*8192;l=e[6]&2?h:0;b=o?0:8192;M=0;s=e[9]&1?O.Region.PAL:O.Region.NTSC}if(r===0){throw new Error("Invalid header: 0 PRG ROM units")}var T=16+(e[6]&4?512:0);var N=r*16384;var z=T+N;var q=z;var H=o*8192;var f=q+H;var d=Wn[P]||P.toString();if(d===O.Mapper.BNROM&&H>0){d=O.Mapper.NINA_001}var g=Zn[$t(P,S)];if(e.length<
f){throw new Error("Input is too short: expected at least ".concat((0,O.formatSize)(f)," but got ").concat((0,O.formatSize)(e.length)))}var y=e.subarray(T,z);var m=H?e.subarray(q,f):void 0;return{version:t,mirroring:a,region:s,mapper:d,submapper:g,prgROMSize:N,prgROM:y,prgRAMSize:h,prgRAMSizeBattery:l,chrROMSize:H,chrROM:m,chrRAMSize:b,chrRAMSizeBattery:M}}function Jt(e){if(e>0){return Math.pow(2,e-1)*128}return 0}});var pi=c(function(it){"use strict";var $n=it&&it.__createBinding||(Object.create?function(e,t,r,o){if(o===void 0)o=r;var s=Object.getOwnPropertyDescriptor(t,r);if(!s||("get"in s?!t.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,o,s)}:function(e,t,r,o){if(o===void 0)o=r;e[o]=t[r]});var ts=it&&it.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});
var es=it&&it.__importStar||function(){var e=function(t){e=Object.getOwnPropertyNames||function(r){var o=[];for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s))o[o.length]=s;return o};return e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(t!=null){for(var o=e(t),s=0;s<o.length;s++)if(o[s]!=="default")$n(r,t,o[s])}ts(r,t);return r}}();Object.defineProperty(it,"__esModule",{value:true});var rs=es(ui());it.default=[rs]});var hi=c(function(Te){"use strict";Object.defineProperty(Te,"__esModule",{value:true});Te.default=ns;var R="0123456789abcdef".split("");var is=[-2147483648,8388608,32768,128];var os=[24,16,8,0];function ns(e){var t=e.length;var r=new Array(17);var o=0;var s=0;var a=0;var P=0;var S=false;var h,l,b,M;var T=1732584193;var N=4023233417;var z=2562383102;var q=271733878;var H=3285377520;do{r[0]=o;r.fill(0,1,17);for(b=a;s<t&&b<64;s++){r[b>>2]|=e[s]<<os[b++&3]}P+=b-a;a=b-64;if(s===t){r[b>>2]|=is[b&3];s++}
o=r[16];if(s>t&&b<56){r[15]=P<<3;S=true}for(M=16;M<80;M++){h=r[M-3]^r[M-8]^r[M-14]^r[M-16];r[M]=h<<1|h>>>31}var f=T,d=N,g=z,y=q,m=H;for(M=0;M<20;M+=5){l=d&g|~d&y;h=f<<5|f>>>27;m=h+l+m+1518500249+r[M]<<0;d=d<<30|d>>>2;l=f&d|~f&g;h=m<<5|m>>>27;y=h+l+y+1518500249+r[M+1]<<0;f=f<<30|f>>>2;l=m&f|~m&d;h=y<<5|y>>>27;g=h+l+g+1518500249+r[M+2]<<0;m=m<<30|m>>>2;l=y&m|~y&f;h=g<<5|g>>>27;d=h+l+d+1518500249+r[M+3]<<0;y=y<<30|y>>>2;l=g&y|~g&m;h=d<<5|d>>>27;f=h+l+f+1518500249+r[M+4]<<0;g=g<<30|g>>>2}for(;M<40;M+=
5){l=d^g^y;h=f<<5|f>>>27;m=h+l+m+1859775393+r[M]<<0;d=d<<30|d>>>2;l=f^d^g;h=m<<5|m>>>27;y=h+l+y+1859775393+r[M+1]<<0;f=f<<30|f>>>2;l=m^f^d;h=y<<5|y>>>27;g=h+l+g+1859775393+r[M+2]<<0;m=m<<30|m>>>2;l=y^m^f;h=g<<5|g>>>27;d=h+l+d+1859775393+r[M+3]<<0;y=y<<30|y>>>2;l=g^y^m;h=d<<5|d>>>27;f=h+l+f+1859775393+r[M+4]<<0;g=g<<30|g>>>2}for(;M<60;M+=5){l=d&g|d&y|g&y;h=f<<5|f>>>27;m=h+l+m-1894007588+r[M]<<0;d=d<<30|d>>>2;l=f&d|f&g|d&g;h=m<<5|m>>>27;y=h+l+y-1894007588+r[M+1]<<0;f=f<<30|f>>>2;l=m&f|m&d|f&d;h=y<<
5|y>>>27;g=h+l+g-1894007588+r[M+2]<<0;m=m<<30|m>>>2;l=y&m|y&f|m&f;h=g<<5|g>>>27;d=h+l+d-1894007588+r[M+3]<<0;y=y<<30|y>>>2;l=g&y|g&m|y&m;h=d<<5|d>>>27;f=h+l+f-1894007588+r[M+4]<<0;g=g<<30|g>>>2}for(;M<80;M+=5){l=d^g^y;h=f<<5|f>>>27;m=h+l+m-899497514+r[M]<<0;d=d<<30|d>>>2;l=f^d^g;h=m<<5|m>>>27;y=h+l+y-899497514+r[M+1]<<0;f=f<<30|f>>>2;l=m^f^d;h=y<<5|y>>>27;g=h+l+g-899497514+r[M+2]<<0;m=m<<30|m>>>2;l=y^m^f;h=g<<5|g>>>27;d=h+l+d-899497514+r[M+3]<<0;y=y<<30|y>>>2;l=g^y^m;h=d<<5|d>>>27;f=h+l+f-899497514+
r[M+4]<<0;g=g<<30|g>>>2}T=T+f<<0;N=N+d<<0;z=z+g<<0;q=q+y<<0;H=H+m<<0}while(!S);return R[T>>28&15]+R[T>>24&15]+R[T>>20&15]+R[T>>16&15]+R[T>>12&15]+R[T>>8&15]+R[T>>4&15]+R[T&15]+R[N>>28&15]+R[N>>24&15]+R[N>>20&15]+R[N>>16&15]+R[N>>12&15]+R[N>>8&15]+R[N>>4&15]+R[N&15]+R[z>>28&15]+R[z>>24&15]+R[z>>20&15]+R[z>>16&15]+R[z>>12&15]+R[z>>8&15]+R[z>>4&15]+R[z&15]+R[q>>28&15]+R[q>>24&15]+R[q>>20&15]+R[q>>16&15]+R[q>>12&15]+R[q>>8&15]+R[q>>4&15]+R[q&15]+R[H>>28&15]+R[H>>24&15]+R[H>>20&15]+R[H>>16&15]+R[H>>12&
15]+R[H>>8&15]+R[H>>4&15]+R[H&15]}});var Ne=c(function(Ht){"use strict";var ci=Ht&&Ht.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(Ht,"__esModule",{value:true});Ht.default=us;var F=B();var ss=ci(pi());var as=ci(hi());function us(e){F.log.info("Creating cartridge from ROM image");if(!(e instanceof Uint8Array)){throw new Error("Invalid ROM image: "+(0,F.describe)(e))}F.log.info("Parsing ".concat((0,F.formatSize)(e.length)," of data"));for(var t=0,r=ss.default;t<r.length;t++){var o=r[t];if(o.
supports(e)){F.log.info('Using "'.concat(o.name,'" parser'));var s=o.parse(e);ps(s);hs(s);return s}}throw new Error("Unknown ROM image format")}function ps(e){F.log.info("Computing SHA-1");var t=new Uint8Array(e.prgROMSize+e.chrROMSize);t.set(e.prgROM);if(e.chrROM){t.set(e.chrROM,e.prgROMSize)}e.sha1=(0,as.default)(t)}function hs(e){F.log.info("==========[Cartridge Info - Start]==========");F.log.info("SHA-1                 : "+e.sha1);F.log.info("Mapper                : "+e.mapper);F.log.info("\
Submapper             : "+e.submapper);F.log.info("Region                : "+e.region);F.log.info("Mirroring             : "+e.mirroring);F.log.info("PRG ROM size          : "+(0,F.formatSize)(e.prgROMSize));F.log.info("PRG RAM size          : "+(0,F.formatSize)(e.prgRAMSize));F.log.info("PRG RAM size (battery): "+(0,F.formatSize)(e.prgRAMSizeBattery));F.log.info("CHR ROM size          : "+(0,F.formatSize)(e.chrROMSize));F.log.info("CHR RAM size          : "+(0,F.formatSize)(e.chrRAMSize));F.log.
info("CHR RAM size (battery): "+(0,F.formatSize)(e.chrRAMSizeBattery));F.log.info("==========[Cartridge Info - End]==========")}});var li=c(function(zt){"use strict";var cs=zt&&zt.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(zt,"__esModule",{value:true});zt.default=ds;var ls=B();var fs=cs(Ne());function ds(e){ls.log.info('Reading ROM image from file "'.concat(e,'"'));var t=[];return(0,fs.default)(new Uint8Array(t))}});var di=c(function(at){"use strict";var fi=at&&at.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(at,"__esModule",{value:true});at.readCartridge=at.createCartridge=void 0;var As=Ne();Object.defineProperty(at,"createCartridge",{enumerable:true,get:function(){return fi(As).default}});var gs=li();Object.defineProperty(at,"readCartridge",{enumerable:true,get:function(){return fi(gs).default}})});var gi=c(function(A){"use strict";var ys=A&&A.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(A,"__esModule",{value:true});A.VIDEO_HEIGHT=A.VIDEO_WIDTH=A.BLACK_COLOR=A.DEFAULT_PALETTE=A.unpackColor=A.isPaletteName=A.createPalette=A.PPU=A.describe=A.formatSize=A.Mapper=A.Region=A.LogLevel=A.log=A.readCartridge=A.createCartridge=A.Zapper=A.Joypad=A.Button=A.CPU=A.APU=A.NES=void 0;var ms=Jr();Object.defineProperty(A,"NES",{enumerable:true,get:function(){return ys(
ms).default}});var Ms=De();Object.defineProperty(A,"APU",{enumerable:true,get:function(){return Ms.APU}});var Rs=Oe();Object.defineProperty(A,"CPU",{enumerable:true,get:function(){return Rs.CPU}});var He=si();Object.defineProperty(A,"Button",{enumerable:true,get:function(){return He.Button}});Object.defineProperty(A,"Joypad",{enumerable:true,get:function(){return He.Joypad}});Object.defineProperty(A,"Zapper",{enumerable:true,get:function(){return He.Zapper}});var Ai=di();Object.defineProperty(A,
"createCartridge",{enumerable:true,get:function(){return Ai.createCartridge}});Object.defineProperty(A,"readCartridge",{enumerable:true,get:function(){return Ai.readCartridge}});var St=B();Object.defineProperty(A,"log",{enumerable:true,get:function(){return St.log}});Object.defineProperty(A,"LogLevel",{enumerable:true,get:function(){return St.LogLevel}});Object.defineProperty(A,"Region",{enumerable:true,get:function(){return St.Region}});Object.defineProperty(A,"Mapper",{enumerable:true,get:function(){
return St.Mapper}});Object.defineProperty(A,"formatSize",{enumerable:true,get:function(){return St.formatSize}});Object.defineProperty(A,"describe",{enumerable:true,get:function(){return St.describe}});var ut=Gt();Object.defineProperty(A,"PPU",{enumerable:true,get:function(){return ut.PPU}});Object.defineProperty(A,"createPalette",{enumerable:true,get:function(){return ut.createPalette}});Object.defineProperty(A,"isPaletteName",{enumerable:true,get:function(){return ut.isPaletteName}});Object.defineProperty(
A,"unpackColor",{enumerable:true,get:function(){return ut.unpackColor}});Object.defineProperty(A,"DEFAULT_PALETTE",{enumerable:true,get:function(){return ut.DEFAULT_PALETTE}});Object.defineProperty(A,"BLACK_COLOR",{enumerable:true,get:function(){return ut.BLACK_COLOR}});Object.defineProperty(A,"VIDEO_WIDTH",{enumerable:true,get:function(){return ut.VIDEO_WIDTH}});Object.defineProperty(A,"VIDEO_HEIGHT",{enumerable:true,get:function(){return ut.VIDEO_HEIGHT}})});var qe=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(exports,"__esModule",{value:true});var Ps=qe(require("display"));var ze=qe(require("keyboard"));var $=gi();var vs=qe(require("storage"));function Xe(e,t,r){var o=this.valueOf();var s=o.length;t=parseInt(t,10)||0;r=r===void 0?s:parseInt(r,10)||0;var a;var P;if(t<0){a=Math.max(s+t,0)}else{a=Math.min(t,s)}if(r<0){P=Math.max(s+r,0)}else{P=Math.min(r,s)}for(;a<P;a++){o[a]=e}return o}if(!Array.
prototype.fill){Array.prototype.fill=Xe}if(!Uint8Array.prototype.fill){Uint8Array.prototype.fill=Xe}if(!Uint32Array.prototype.fill){Uint32Array.prototype.fill=Xe}function _s(){console.log("init nes");var e=new $.NES;console.log("rom load");var t=vs.default.read("/Super Mario Bros (E).nes",true);console.log("cartridge1");var r=(0,$.createCartridge)(t);console.log("nes.setCartridge");e.setCartridge(r);var o=false;var s=false;var a=new $.Joypad;e.setInputDevice(1,a);console.log("videoSprite");var P=(0,
$.createPalette)("fceux");e.setPalette(P);var S=Ps.default.createSprite($.VIDEO_WIDTH,$.VIDEO_HEIGHT,16);e.setRegion(null);var h=now();while(true){if(ze.default.getNextPress()){a.setButtonPressed($.Button.LEFT,true);o=true}else if(o){a.setButtonPressed($.Button.LEFT,false);o=false}if(ze.default.getSelPress()){a.setButtonPressed($.Button.A,true);s=true}else if(s){a.setButtonPressed($.Button.A,false);s=false}if(ze.default.getPrevPress()){break}console.log("nes.renderFrame");e.renderFrame(S);S.pushSprite();
console.log(now()-h);h=now()}}_s();
